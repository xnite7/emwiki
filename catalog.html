<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Epic Catalogue - Catalogue</title>
    <link rel="stylesheet" href="./css/catalog.css?version=3.2">
    <link rel="manifest" href="/dev.webmanifest">
    <script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2"></script>
</head>
<div class="bn">
    üõ†Ô∏è Site updated May 31 ‚Äî <a style="color: #33c5ff;" href="#patchnotes">See
        what's new</a> ‚Äî All the items have been added!

    <button
        style="right: 15px;position: absolute;padding: 5px 10px;font-size: 17px;border-radius: 8px;background: transparent;border: none;cursor: pointer;"
        onclick="document.querySelector('.bn').remove()">x</button>
</div>

<body>
    <header>
        <a href="https://emwiki.site">
            <svg width="500" height="300" viewBox="451 471 100 39" xmlns="http://www.w3.org/2000/svg">
                <style>
                    @import url(https://emwiki.site/css/fonts.css);

                    @keyframes floatAnim {

                        0%,
                        to {
                            transform: translateY(0)
                        }

                        50% {
                            transform: translateY(-4px)
                        }
                    }

                    @keyframes glowPulse {

                        0%,
                        to {
                            filter: drop-shadow(0 0 0#fff)
                        }

                        50% {
                            filter: drop-shadow(0 0 8px #ff0) drop-shadow(0 0 15px #24ff5a)
                        }
                    }

                    @keyframes gradientShift {

                        0%,
                        to {
                            stop-color: #ff0
                        }

                        50% {
                            stop-color: #24ff5a
                        }
                    }
                </style>
                <defs>
                    <linearGradient id="eppp1" y1="1" x2="0">
                        <stop offset=".2" style="stop-color:#ff0" />
                        <stop offset="1" style="stop-color:#24ff5a" />
                    </linearGradient>
                    <linearGradient id="eppp2" y1="1" x2="0">
                        <stop offset="0" style="stop-color:#24ff5d" />
                        <stop offset="1" style="stop-color:#ff0" />
                    </linearGradient>
                </defs>
                <image x="464" y="463" href="https://emwiki.site/imgs/TWOKPhY.png" height="60" width="60"
                    style="filter:opacity(.6)" /><text x="489" y="503" text-anchor="middle" stroke="#000"
                    stroke-width="2.3" paint-order="stroke" stroke-linejoin="round" fill="url(#eppp1)"
                    style="animation:floatAnim 12s ease-in-out infinite;font:200 46px Bunny Flowers">Epic</text>
                <g
                    style="scale:.39;transform:translate(1592px,697px);rotate:20deg;transform-origin:center;animation:floatAnim2 15s ease-in-out 1s infinite alternate">
                    <circle cy="37.5" cx="36" r="35.5" />
                    <circle cy="37.5" cx="36" r="33" fill="#fede58" />
                    <path
                        d="M32.5 66.5c-12-2-19.5-11.5-21-23.5v-.5H9l-.5-2H57c.5 1.5 1 2.5 1 4C59.5 54 54.5 59 46.5 64c-4.5 2-9 3-14 2.5" />
                    <path
                        d="M37 64.5c5.5-.5 10-2.5 14-6 3-2.5 4.5-5.5 5-8.5.5-2 0-6-.5-7l-42-.5c-.5 6 3.5 12 7 16 3.5 3.5 7.5 5 12 6 1 .5 3.5.5 4.5 0"
                        fill="#871945" />
                    <path d="M7.5 34C2 10 29 12 25.5 32l-.5 2Z" />
                    <path
                        d="M23.5 32.5c.5-1 .5-4 0-6 0-1.5-.5-1.5-1-1-1.5 1.5-3.5 1.5-5 0-1.5-2-1.5-4 .5-5.5l.5-.5c-.5-1.5-8.5-2.5-10 7-.5 1.5 0 5 .5 6z"
                        fill="#fff" />
                    <path d="M38 34.5C35 21 42 18 45.5 17c3-.5 5.5 0 8 1.5 2.5 2 4.5 5 5 8.5 0 5.5-.5 7-.5 7.5Z" />
                    <path
                        d="M56.5 32.5c.5-.5.5-3.5.5-5-.5-1.5-.5-2.5-1-2.5l-.5.5c-1.5 1.5-4.5 1.5-6-1-.5-1.5 0-3 1-4 .5-.5.5-1 .5-1s0-.5-.5-.5c-5-1.5-10.5 2-11.5 8-.5 1.5 0 4.5.195 5.503Z"
                        fill="#fff" />
                    <path d="M48.883 60.176S45.5 63 39.5 64.5c-6.5 1.5-11-1-11-1s1-7.5 9-9.5c7.5-1.5 13 5 13 5Z"
                        fill="#f9bedd" />
                </g>
                <image x="495" y="478" href="https://emwiki.site/imgs/8UUB0Gt.png" height="60" width="60"
                    style="filter:opacity(.86)" /><text x="516" y="514" text-anchor="middle" stroke="#000"
                    stroke-width="2.3" paint-order="stroke" stroke-linejoin="round" fill="url(#eppp2)"
                    style="animation:floatAnim 12s ease-in-out infinite;animation-delay:5.5s;font:200 16px Bunny Flowers">Catalogue</text>
                <image x="438" y="489" href="https://emwiki.site/imgs/oYKd3nJ.png" height="28" width="42"
                    style="filter:opacity(.9)" />
            </svg>
        </a>
        <div class="theme-toggle" onclick="catalog.toggleTheme()"></div>
    </header>

    <!-- Category Carousel -->
    <div class="category-carousel-container">
        <div class="category-carousel" id="categoryCarousel"></div>
        <div class="carousel-nav prev" onclick="catalog.prevCategory()"></div>
        <div class="carousel-nav next" onclick="catalog.nextCategory()"></div>
    </div>

    <!-- Controls Bar -->
    <div class="controls-bar">
        <div class="controls-row">
            <!-- Search with Recent Items -->
            <div class="search-wrapper">
                <input id="search-bar" type="text" placeholder="Search items..." />
                <div id="recent-items" class="recent-items"></div>
            </div>

            <!-- Sort Dropdown -->
            <div class="sort-dropdown">
                <button class="dropdown-btn" onclick="catalog.toggleSort()">
                    <span>Sort:</span> <span id="sort-label">Categorical</span> ‚ñº
                </button>
                <div id="sort-menu" class="dropdown-content">
                    <div class="dropdown-item" data-sort="default">Categorical</div>
                    <div class="dropdown-item" data-sort="name-asc">Name: A ‚ûî Z</div>
                    <div class="dropdown-item" data-sort="name-desc">Name: Z ‚ûî A</div>
                    <div class="dropdown-item" data-sort="price-asc">Price: Low to High</div>
                    <div class="dropdown-item" data-sort="price-desc">Price: High to Low</div>

                </div>
            </div>



            <!-- Season Filter -->
            <div class="season-dropdown">
                <button class="dropdown-btn" onclick="catalog.toggleSeason()">
                    <span>Season:</span> <span id="season-label">All</span> ‚ñº
                </button>
                <div id="season-menu" class="dropdown-content">
                    <div class="dropdown-item active" data-season="all">All Seasons</div>
                </div>
            </div>

            <!-- Stats Dashboard -->
            <button class="stats-btn" onclick="catalog.openStats()">My Lists</button>
        </div>

        <div class="filters">
            <button class="filter-chip" data-filter="new"><span class="icon newest-icon"></span> New</button>
            <button class="filter-chip" data-filter="untradable"><span class="icon untradable-icon"></span>
                Untradable</button>
            <button class="filter-chip" style="display: none;" data-filter="premium"><span
                    class="icon premium-icon"></span> Premium</button>
            <button class="filter-chip" data-filter="retired"><span class="icon retired-icon"></span> Retired</button>
            <button class="filter-chip" data-filter="favorites"><span class="icon favorites-icon"></span>
                Favorites</button>
        </div>



        <div class="chest-dropdown">
            <a class="chest-expand-toggle" onclick="catalog.toggleChestExpand()">View advanced filters</a>
            <button class="filter-chip" data-filter="gamenight"><span class="icon gamenight-icon"></span>
                Gamenight</button>

            <button class="chest-dropdown-btn" onclick="catalog.toggleChestMenu()">
                <span>Chest:</span>
                <span id="chest-label">None</span>
                <span>‚ñº</span>
            </button>
            <button class="filter-chip" style="padding-bottom: 8px;" data-filter="unreleased">üõ° Staff/Unreleased</button>
            <div id="chest-menu" class="chest-menu">
                <div class="chest-item" data-chest="all" onclick="catalog.selectChest('all')">
                    <svg style="width: 32px;margin: 0 18px 0 4px;" viewBox="0 0 1920 1920" fill="url(#nostops)"
                        xmlns="http://www.w3.org/2000/svg">
                        <defs>
                            <linearGradient id="nostops" y2="100%">
                                <stop style="stop-color:#fff6ee" />
                                <stop offset="1" style="stop-color:#555" />
                            </linearGradient>
                        </defs>
                        <path stroke="#fff" paint-order="stroke" stroke-width="5"
                            d="M213.333 960c0-167.36 56-321.707 149.44-446.4L1406.4 1557.227c-124.693 93.44-279.04 149.44-446.4 149.44-411.627 0-746.667-335.04-746.667-746.667m1493.334 0c0 167.36-56 321.707-149.44 446.4L513.6 362.773c124.693-93.44 279.04-149.44 446.4-149.44 411.627 0 746.667 335.04 746.667 746.667M960 0C429.76 0 0 429.76 0 960s429.76 960 960 960 960-429.76 960-960S1490.24 0 960 0"
                            fill-rule="evenodd" />
                    </svg>
                    <div class="chest-item-info">
                        <div class="chest-name">None</div>
                        <div class="chest-meta">Show everything</div>
                    </div>
                </div>
                <div class="chest-item" data-chest="itemcrate" onclick="catalog.selectChest('itemcrate')">
                    <img src="https://i.imgur.com/lZXN7AA.png" alt="Item Crate">
                    <div class="chest-item-info">
                        <div class="chest-name">Item Crate</div>
                        <div class="chest-meta">
                            <span class="chest-timer"><svg fill="#87ceeb"
                                    style="margin-right: 1px;margin-left: 3px;width: 12px;transform: translateY(2px);"
                                    viewBox="0 0 22.5 22.5" xmlns="http://www.w3.org/2000/svg">
                                    <path
                                        d="M11.188 22.5C5 22.5 0 17.5 0 11.312S5 .093 11.188.093s11.219 5.031 11.219 11.219S17.376 22.5 11.188 22.5m0-19.625c-4.625 0-8.375 3.813-8.375 8.438s3.75 8.375 8.375 8.375 8.438-3.75 8.438-8.375-3.813-8.438-8.438-8.438m3.031 12.718-3.969-2.906c-.281-.219-.563-.688-.563-1.063V5.28c0-.344.313-.625.688-.625h1.313c.344 0 .625.281.625.625v5c0 .375.281.844.563 1.063l2.906 2.094a.687.687 0 0 1 .125.938l-.781 1.063a.684.684 0 0 1-.906.156z" />
                                </svg> 15:00</span>
                        </div>
                    </div>
                </div>
                <div class="chest-item" data-chest="luckychest" onclick="catalog.selectChest('luckychest')">
                    <img src="https://i.imgur.com/WFdzb0V.png" alt="Lucky Chest">
                    <div class="chest-item-info">
                        <div class="chest-name">Lucky Chest</div>
                        <div class="chest-meta">
                            <span class="chest-timer"><svg fill="#87ceeb"
                                    style="margin-right: 1px;margin-left: 3px;width: 12px;transform: translateY(2px);"
                                    viewBox="0 0 22.5 22.5" xmlns="http://www.w3.org/2000/svg">
                                    <path
                                        d="M11.188 22.5C5 22.5 0 17.5 0 11.312S5 .093 11.188.093s11.219 5.031 11.219 11.219S17.376 22.5 11.188 22.5m0-19.625c-4.625 0-8.375 3.813-8.375 8.438s3.75 8.375 8.375 8.375 8.438-3.75 8.438-8.375-3.813-8.438-8.438-8.438m3.031 12.718-3.969-2.906c-.281-.219-.563-.688-.563-1.063V5.28c0-.344.313-.625.688-.625h1.313c.344 0 .625.281.625.625v5c0 .375.281.844.563 1.063l2.906 2.094a.687.687 0 0 1 .125.938l-.781 1.063a.684.684 0 0 1-.906.156z" />
                                </svg> 30:00</span>
                        </div>
                    </div>
                </div>
                <div class="chest-item" data-chest="1hrplaytime" onclick="catalog.selectChest('1hrplaytime')">
                    <img src="https://i.imgur.com/IBCeaLF.png" alt="1 Hour Playtime">
                    <div class="chest-item-info">
                        <div class="chest-name">1 Hour Playtime</div>
                        <div class="chest-meta">
                            <span class="chest-timer"><svg fill="#87ceeb"
                                    style="margin-right: 1px;margin-left: 3px;width: 12px;transform: translateY(2px);"
                                    viewBox="0 0 22.5 22.5" xmlns="http://www.w3.org/2000/svg">
                                    <path
                                        d="M11.188 22.5C5 22.5 0 17.5 0 11.312S5 .093 11.188.093s11.219 5.031 11.219 11.219S17.376 22.5 11.188 22.5m0-19.625c-4.625 0-8.375 3.813-8.375 8.438s3.75 8.375 8.375 8.375 8.438-3.75 8.438-8.375-3.813-8.438-8.438-8.438m3.031 12.718-3.969-2.906c-.281-.219-.563-.688-.563-1.063V5.28c0-.344.313-.625.688-.625h1.313c.344 0 .625.281.625.625v5c0 .375.281.844.563 1.063l2.906 2.094a.687.687 0 0 1 .125.938l-.781 1.063a.684.684 0 0 1-.906.156z" />
                                </svg> 1:00:00</span>
                        </div>
                    </div>
                </div>
                <div class="chest-item" data-chest="mysterybag" onclick="catalog.selectChest('mysterybag')">
                    <img src="https://i.imgur.com/mLNEYGn.png" alt="Mystery Bag">
                    <div class="chest-item-info">
                        <div class="chest-name">Mystery Bag</div>
                        <div class="chest-meta">Random rewards</div>
                    </div>
                </div>
                <div class="chest-item" data-chest="typicalchest" onclick="catalog.selectChest('typicalchest')">
                    <img src="https://i.imgur.com/bpigTac.png" alt="Typical Chest">
                    <div class="chest-item-info">
                        <div class="chest-name">Typical Chest</div>
                        <div class="chest-meta">
                            <span class="chest-price"><img src="./imgs/Coin.webp"
                                    style="transform: translateY(2px);margin-right: 2px;margin-left: 3px;width: 12px;height: 12px;">
                                250</span>
                        </div>
                    </div>
                </div>
                <div class="chest-item" data-chest="dailyrewards" onclick="catalog.selectChest('dailyrewards')">
                    <img src="https://i.imgur.com/IBCeaLF.png" alt="Daily Rewards Secret Item">
                    <div class="chest-item-info">
                        <div class="chest-name">Daily Rewards Secret Item</div>
                        <div class="chest-meta">
                            <span class="chest-timer"><svg fill="#87ceeb"
                                    style="margin-right: 1px;margin-left: 3px;width: 12px;transform: translateY(2px);"
                                    viewBox="0 0 22.5 22.5" xmlns="http://www.w3.org/2000/svg">
                                    <path
                                        d="M11.188 22.5C5 22.5 0 17.5 0 11.312S5 .093 11.188.093s11.219 5.031 11.219 11.219S17.376 22.5 11.188 22.5m0-19.625c-4.625 0-8.375 3.813-8.375 8.438s3.75 8.375 8.375 8.375 8.438-3.75 8.438-8.375-3.813-8.438-8.438-8.438m3.031 12.718-3.969-2.906c-.281-.219-.563-.688-.563-1.063V5.28c0-.344.313-.625.688-.625h1.313c.344 0 .625.281.625.625v5c0 .375.281.844.563 1.063l2.906 2.094a.687.687 0 0 1 .125.938l-.781 1.063a.684.684 0 0 1-.906.156z" />
                                </svg> 24H</span>
                        </div>
                    </div>
                </div>
                <div class="chest-item" data-chest="premiumchest" onclick="catalog.selectChest('premiumchest')">
                    <img src="https://i.imgur.com/vwb0OJv.png" alt="Premium Chest">
                    <div class="chest-item-info">
                        <div class="chest-name">Premium Chest</div>
                        <div class="chest-meta">
                            <span class="chest-price"><svg
                                    style="margin-right: 3px;margin-left: 3px;width: 12px;transform: translateY(4px);"
                                    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16.6 18">
                                    <path
                                        d="M6.251 6.993v3.999h4.025V6.99Zm-.156-4.689c1.917-1.213 2.507-1.154 4.484.034l3.37 2.027c.648.43 1.255.949 1.157 2.077v4.444c.009 1.578-.127 2.032-1.065 2.656l-3.492 2.052c-2.118 1.195-2.219 1.353-4.55.001l-3.28-1.913c-.886-.562-1.373-1.115-1.315-2.45V6.733c-.025-1.63.458-1.874 1.242-2.405Zm.395 1.298c1.287-.804 1.855-1.088 3.612.034l2.777 1.641c.568.423.954.838.96 1.652v3.952c-.007.705-.271 1.405-.9 1.77l-2.813 1.684c-1.786.942-1.799 1.004-3.127.287l-3.22-1.835c-.658-.474-1.038-.651-1.006-2.009V7.131c.005-1.044.193-1.432.991-1.952ZM5.605.944C7.71-.331 8.871-.345 11.011.985l4.062 2.444c.646.363 1.512 1.515 1.528 2.588v5.847c.003 1.055-.645 2.014-1.424 2.63l-4.178 2.501c-1.843 1.087-3.052 1.56-5.486.002l-3.928-2.348C.71 14.043-.006 13.267 0 11.695V6.272c.033-1.551.668-2.233 1.498-2.899Z"
                                        fill="#FFD700" fill-rule="evenodd"></path>
                                </svg> 99</span>
                        </div>
                    </div>
                </div>
                <div class="chest-item" data-chest="steelchest" onclick="catalog.selectChest('steelchest')">
                    <img src="https://i.imgur.com/joSfryH.png" alt="Steel Chest">
                    <div class="chest-item-info">
                        <div class="chest-name">Steel Chest</div>
                        <div class="chest-meta">Rare items</div>
                    </div>
                </div>
                <div class="chest-item" data-chest="elusivebag" onclick="catalog.selectChest('elusivebag')">
                    <img src="https://i.imgur.com/MmrUfl7.png" alt="Elusive Bag">
                    <div class="chest-item-info">
                        <div class="chest-name">Elusive Bag</div>
                        <div class="chest-meta">Ultra rare</div>
                    </div>
                </div>
                <div class="chest-item" data-chest="legendarychest" onclick="catalog.selectChest('legendarychest')">
                    <img src="https://i.imgur.com/9Fph277.png" alt="Legendary Chest">
                    <div class="chest-item-info">
                        <div class="chest-name">Legendary Chest</div>
                        <div class="chest-meta">Legendary items</div>
                    </div>
                </div>
                <div class="chest-item" data-chest="epicchest" onclick="catalog.selectChest('epicchest')">
                    <img src="https://i.imgur.com/Efwzbme.png" alt="Epic Chest">
                    <div class="chest-item-info">
                        <div class="chest-name">Epic Chest</div>
                        <div class="chest-meta">
                            <span class="chest-price" style="
    					font-family: arimo;
    					font-weight: 500;
    					color: #fff;
    					/* -webkit-text-stroke: 1px rgb(255, 83, 219); */
    					text-shadow: -1.3px -1.3px 0 #ff53db, 0 -1.3px 0 #ff53db, 1.3px -1.3px 0 #ff53db, 1.3px 0 0 #ff53db, 1.3px 1.3px 0 #ff53db, 0 1.3px 0 #ff53db, -1.3px 1.3px 0 #ff53db, -1.3px 0 0 #ff53db;
    					"><img src="https://i.imgur.com/Cy9r140.png"
                                    style="transform: translateY(2px);margin-right: 3px;margin-left: 3px;width: 12px;height: 12px;">500</span>
                        </div>
                    </div>
                </div>
                <div class="chest-item" data-chest="birthdaychest" onclick="catalog.selectChest('birthdaychest')">
                    <img src="https://emwiki.site/imgs/61c1df478cf7c4297798fbafe4784899.png" alt="Birthday Chest">
                    <div class="chest-item-info">
                        <div class="chest-name">Birthday Chest</div>
                        <div class="chest-meta">
                            <span class="chest-price"><svg
                                    style="margin-right: 3px;margin-left: 3px;width: 12px;transform: translateY(4px);"
                                    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16.6 18">
                                    <path
                                        d="M6.251 6.993v3.999h4.025V6.99Zm-.156-4.689c1.917-1.213 2.507-1.154 4.484.034l3.37 2.027c.648.43 1.255.949 1.157 2.077v4.444c.009 1.578-.127 2.032-1.065 2.656l-3.492 2.052c-2.118 1.195-2.219 1.353-4.55.001l-3.28-1.913c-.886-.562-1.373-1.115-1.315-2.45V6.733c-.025-1.63.458-1.874 1.242-2.405Zm.395 1.298c1.287-.804 1.855-1.088 3.612.034l2.777 1.641c.568.423.954.838.96 1.652v3.952c-.007.705-.271 1.405-.9 1.77l-2.813 1.684c-1.786.942-1.799 1.004-3.127.287l-3.22-1.835c-.658-.474-1.038-.651-1.006-2.009V7.131c.005-1.044.193-1.432.991-1.952ZM5.605.944C7.71-.331 8.871-.345 11.011.985l4.062 2.444c.646.363 1.512 1.515 1.528 2.588v5.847c.003 1.055-.645 2.014-1.424 2.63l-4.178 2.501c-1.843 1.087-3.052 1.56-5.486.002l-3.928-2.348C.71 14.043-.006 13.267 0 11.695V6.272c.033-1.551.668-2.233 1.498-2.899Z"
                                        fill="#FFD700" fill-rule="evenodd"></path>
                                </svg> 99</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>





    <!-- Stats -->
    <div class="stats">
        Showing <span id="showing">0</span><span id="total">0</span> items
    </div>

    <!-- Catalog -->
    <div class="catalog-container">
        <div id="catalog" class="catalog-grid"></div>
        <div class="load-more">
            <button id="loadMore" class="load-button">Load More Items</button>
        </div>
    </div>

    <!-- Stats Dashboard Modal -->
    <div id="stats-dashboard" class="stats-dashboard">
        <div class="stats-content">
            <div class="stats-header">
                <h2 style="font-size: 41px;letter-spacing: 2px;font-family: pacifico;">My Lists</h2>
                <span class="close-stats" onclick="catalog.closeStats()">√ó</span>
            </div>

            <div class="wishlist-section">
                <h3 style="font-size: 23px;font-variant: all-petite-caps;"><svg fill="#fff" viewBox="0 0 24 24"
                        xmlns="http://www.w3.org/2000/svg" style="width:26px;margin-bottom:-7px;">
                        <path
                            d="M14 10h-1V9c0-.6-.4-1-1-1s-1 .4-1 1v1h-1c-.6 0-1 .4-1 1s.4 1 1 1h1v1c0 .6.4 1 1 1s1-.4 1-1v-1h1c.6 0 1-.4 1-1s-.4-1-1-1" />
                        <path
                            d="M19 3H5c-.6 0-1 .4-1 1s.4 1 1 1v14.1c0 .7.4 1.4 1.1 1.8.3.2.6.2.9.2.4 0 .8-.1 1.1-.3l3.9-2.6 3.9 2.6c.6.4 1.4.5 2.1.1.7-.3 1.1-1 1.1-1.8V5c.6 0 1-.4 1-1s-.5-1-1.1-1m-2 16.1-3.9-2.6c-.3-.2-.7-.3-1.1-.3s-.8.1-1.1.3L7 19.1V5h10z" />
                    </svg> Wishlist</h3>
                <div id="wishlist-items" class="wishlist-items"></div>
                <div class="wishlist-total">
                    Estimated Total Value: <svg
                        style="margin-right: 3px;margin-left: 3px;width: 18px;transform: translateY(4px);"
                        xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16.6 18">
                        <path
                            d="M6.251 6.993v3.999h4.025V6.99Zm-.156-4.689c1.917-1.213 2.507-1.154 4.484.034l3.37 2.027c.648.43 1.255.949 1.157 2.077v4.444c.009 1.578-.127 2.032-1.065 2.656l-3.492 2.052c-2.118 1.195-2.219 1.353-4.55.001l-3.28-1.913c-.886-.562-1.373-1.115-1.315-2.45V6.733c-.025-1.63.458-1.874 1.242-2.405Zm.395 1.298c1.287-.804 1.855-1.088 3.612.034l2.777 1.641c.568.423.954.838.96 1.652v3.952c-.007.705-.271 1.405-.9 1.77l-2.813 1.684c-1.786.942-1.799 1.004-3.127.287l-3.22-1.835c-.658-.474-1.038-.651-1.006-2.009V7.131c.005-1.044.193-1.432.991-1.952ZM5.605.944C7.71-.331 8.871-.345 11.011.985l4.062 2.444c.646.363 1.512 1.515 1.528 2.588v5.847c.003 1.055-.645 2.014-1.424 2.63l-4.178 2.501c-1.843 1.087-3.052 1.56-5.486.002l-3.928-2.348C.71 14.043-.006 13.267 0 11.695V6.272c.033-1.551.668-2.233 1.498-2.899Z"
                            fill="#fff" fill-rule="evenodd"></path>
                    </svg><span id="wishlist-value"> 0</span>
                </div>
            </div>

            <div class="recent-section">
                <h3 style="font-size: 23px;font-variant: all-petite-caps;"><svg stroke="#fff" fill="#fff"
                        viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg" style="width:23px;margin-bottom:-6px;">
                        <path d="M20.59 22 15 16.41V7h2v8.58l5 5.01z"></path>
                        <path d="M16 2A13.94 13.94 0 0 0 6 6.23V2H4v8h8V8H7.08A12 12 0 1 1 4 16H2A14 14 0 1 0 16 2">
                        </path>
                    </svg> Recently Viewed</h3>
                <div id="recent-viewed-items" class="history-items"></div>
            </div>
        </div>
    </div>

    <!-- Item Modal -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="catalog.closeModal()">√ó</span>
            <div id="modalBody"></div>
        </div>
    </div>

    <!-- Particle Canvas -->
    <canvas id="particle-canvas"></canvas>

    <button
        style="margin-left: 15px; padding: 5px 10px; border-radius: 8px; background: #33c5ff; border: none; cursor: pointer;"
        onclick="window.location.href='https://emwiki.site/admin.html'">Admin</button>

    <script>
        // Clean, simple catalog system
        class Catalog {
            constructor() {
                this.items = [];
                this.filtered = [];
                this.displayed = [];
                this.batchSize = 50;
                this.currentBatch = 0;
                this.loading = false;
                this.currentCategoryIndex = 0;
                this.sortBy = 'default';
                this.seasonFilter = 'all';
                this.chestFilter = 'all';
                this.seasons = new Set();

                this.categories = [
                    { id: 'all', name: 'All', img: './imgs/XwkWVJJ.png', color: '#667eea' },
                    { id: 'gears', name: 'Gears', img: './imgs/AYUbTJv.png', color: '#5bfe6a' },
                    { id: 'deaths', name: 'Deaths', img: './imgs/fADZwOh.png', color: '#ff7a5e' },
                    { id: 'pets', name: 'Pets', img: './imgs/GHXB0nC.png', color: '#377afa' },
                    { id: 'effects', name: 'Effects', img: './imgs/l90cgxf.png', color: '#ffb135' },
                    { id: 'titles', name: 'Titles', img: './imgs/ZOP8l9g.png', color: '#c960fe' }
                ];

                this.filters = {
                    category: 'all',
                    tags: new Set(),
                    search: ''
                };

                this.favorites = this.loadFromStorage('favorites', []);
                this.wishlist = this.loadFromStorage('wishlist', []);
                this.recentlyViewed = this.loadFromStorage('recentlyViewed', []);

                this.particleCanvas = document.getElementById('particle-canvas');
                this.particleCtx = this.particleCanvas.getContext('2d');
                this.particles = [];

                this.chestMappings = {
                    'itemcrate': [],
                    'luckychest': [],
                    '1hrplaytime': [],
                    'mysterybag': [],
                    'dailyrewards': [],
                    'typicalchest': [],
                    'premiumchest': [],
                    'steelchest': [],
                    'elusivebag': [],
                    'legendarychest': [],
                    'epicchest': [],
                    'birthdaychest': [],
                };

                this.init();
            }

            async init() {
                this.setupParticleCanvas();
                this.loadTheme();
                this.renderCategoryCarousel();
                await this.loadData();
                this.populateChests();
                this.setupEventListeners();
                this.applyFilters();
                this.loadBatch();
                this.populateSeasonFilter();

                const chestCollapsed = localStorage.getItem('chestDropdownCollapsed') === 'true';
                if (chestCollapsed) {
                    document.querySelector('.chest-dropdown').classList.add('collapsed');
                    document.querySelector('.chest-expand-toggle').classList.add('collapsed');
                }

            }

            loadFromStorage(key, defaultValue) {
                try {
                    const stored = localStorage.getItem(key);
                    return stored ? JSON.parse(stored) : defaultValue;
                } catch (e) {
                    return defaultValue;
                }
            }

            saveToStorage(key, value) {
                try {
                    localStorage.setItem(key, JSON.stringify(value));
                } catch (e) {
                    console.error('Failed to save to localStorage:', e);
                }
            }

            loadTheme() {
                const theme = localStorage.getItem('theme') || 'dark';
                if (theme === 'light') {
                    document.body.classList.add('light-theme');
                }
            }

            toggleTheme() {
                document.body.classList.toggle('light-theme');
                const theme = document.body.classList.contains('light-theme') ? 'light' : 'dark';
                localStorage.setItem('theme', theme);
            }

            toggleChestMenu() {
                const menu = document.getElementById('chest-menu');
                menu.classList.toggle('show');

                // Close other menus
                document.getElementById('sort-menu').classList.remove('show');
                document.getElementById('season-menu').classList.remove('show');
            }

            selectChest(chest) {
                this.chestFilter = chest;

                // Update UI
                const chestItems = document.querySelectorAll('.chest-item');
                chestItems.forEach(item => {
                    if (item.dataset.chest === chest) {
                        item.classList.add('active');
                    } else {
                        item.classList.remove('active');
                    }
                });

                // Update label
                const selectedChest = document.querySelector(`.chest-item[data-chest="${chest}"] .chest-name`);
                document.getElementById('chest-label').textContent = selectedChest ? selectedChest.textContent : 'All Items';

                // Close menu
                document.getElementById('chest-menu').classList.remove('show');

                // Apply filter
                this.applyFilters();
            }

            setupParticleCanvas() {
                this.resizeCanvas();
                window.addEventListener('resize', () => this.resizeCanvas());
                this.animateParticles();
            }

            resizeCanvas() {
                this.particleCanvas.width = window.innerWidth;
                this.particleCanvas.height = window.innerHeight;
            }

            createParticles(x, y, colors = ['#ff0000', '#ff4444', '#ff8888', '#ffaaaa']) {
                for (let i = 0; i < 20; i++) {
                    this.particles.push({
                        x: x,
                        y: y,
                        vx: (Math.random() - 0.5) * 8,
                        vy: (Math.random() - 0.5) * 8,
                        size: Math.random() * 3 + 2,
                        color: colors[Math.floor(Math.random() * colors.length)],
                        life: 1.0
                    });
                }
            }

            animateParticles() {
                this.particleCtx.clearRect(0, 0, this.particleCanvas.width, this.particleCanvas.height);

                for (let i = this.particles.length - 1; i >= 0; i--) {
                    const p = this.particles[i];

                    p.x += p.vx;
                    p.y += p.vy;
                    p.vy += 0.3; // Gravity
                    p.life -= 0.02;

                    if (p.life <= 0) {
                        this.particles.splice(i, 1);
                        continue;
                    }

                    this.particleCtx.globalAlpha = p.life;
                    this.particleCtx.fillStyle = p.color;
                    this.particleCtx.fillRect(p.x, p.y, p.size, p.size);
                }

                requestAnimationFrame(() => this.animateParticles());
            }
            renderCategoryCarousel() {
                const carousel = document.getElementById('categoryCarousel');

                // Create items only once
                if (!carousel.dataset.initialized) {
                    this.categories.forEach((cat, index) => {
                        const item = document.createElement('div');
                        item.className = 'category-item';
                        item.dataset.category = cat.id;

                        if (cat.img) {
                            const img = document.createElement('img');
                            img.src = cat.img;
                            img.alt = cat.name;
                            item.appendChild(img);
                        }

                        const label = document.createElement('span');
                        label.textContent = cat.name;
                        item.appendChild(label);

                        item.onclick = () => this.selectCategory(index);

                        carousel.appendChild(item);
                    });

                    carousel.dataset.initialized = "true";
                }

                // Update positions & active state
                const items = carousel.querySelectorAll('.category-item');
                const total = this.categories.length;

                items.forEach((item, index) => {
                    let relativePos = index - this.currentCategoryIndex;

                    // Wrap relativePos to shortest path (-N/2 .. N/2)
                    if (relativePos > total / 2) {
                        relativePos -= total;
                    } else if (relativePos < -total / 2) {
                        relativePos += total;
                    }

                    item.dataset.pos = relativePos;

                    if (index === this.currentCategoryIndex) {
                        item.classList.add('active');
                        item.style.borderColor = this.categories[index].color;
                        item.style.backgroundColor = this.categories[index].color + '33';
                    } else {
                        item.classList.remove('active');
                        item.style.borderColor = '';
                        item.style.backgroundColor = '';
                    }
                });

                return carousel;
            }

            selectCategory(index) {
                this.currentCategoryIndex = index;
                this.filters.category = this.categories[index].id;
                this.renderCategoryCarousel();
                this.applyFilters();
            }


            prevCategory() {
                if (this.currentCategoryIndex > 0) {
                    this.selectCategory(this.currentCategoryIndex - 1);
                } else {
                    this.selectCategory(this.categories.length - 1);
                }
            }

            nextCategory() {
                if (this.currentCategoryIndex < this.categories.length - 1) {
                    this.selectCategory(this.currentCategoryIndex + 1);
                } else {
                    this.selectCategory(0);
                }
            }

            async loadData() {
                try {
                    const response = await fetch('https://emwiki.site/api/gist-version');
                    const data = await response.json();
                    const parsed = JSON.parse(data.files?.['auto.json']?.content);

                    const categories = ['gears', 'deaths', 'titles', 'pets', 'effects'];

                    categories.forEach(cat => {
                        if (parsed[cat]) {
                            parsed[cat].forEach(item => {
                                // Extract ALL seasons from description
                                const seasons = [];
                                if (item.from) {
                                    // Use matchAll with global flag to find all season mentions
                                    const seasonMatches = [...item.from.matchAll(/Season (\d+)/gi)];

                                    seasonMatches.forEach(match => {
                                        const seasonNum = parseInt(match[1]);
                                        if (!seasons.includes(seasonNum)) {
                                            seasons.push(seasonNum);
                                            this.seasons.add(seasonNum);
                                        }
                                    });
                                }

                                this.items.push({
                                    ...item,
                                    category: cat,
                                    seasons: seasons // Store as array
                                });
                            });
                        }
                    });

                    document.getElementById('total').textContent = this.items.length;
                } catch (error) {
                    console.error('Failed to load data:', error);
                }
            }

            populateSeasonFilter() {
                const seasonMenu = document.getElementById('season-menu');
                const seasons = Array.from(this.seasons).sort((a, b) => a - b);
                seasonMenu.querySelector('.dropdown-item').onclick = () => this.selectSeason('all');
                seasons.forEach(season => {
                    const item = document.createElement('div');
                    item.className = 'dropdown-item';
                    item.dataset.season = season;
                    item.textContent = `Season ${season}`;
                    item.onclick = () => this.selectSeason(season);
                    seasonMenu.appendChild(item);
                });
            }
            toggleChestExpand() {
                const chestDropdown = document.querySelector('.chest-dropdown');
                const expandToggle = document.querySelector('.chest-expand-toggle');

                chestDropdown.classList.toggle('collapsed');
                expandToggle.classList.toggle('collapsed');
                expandToggle.textContent = 'Hide Advanced Filters';
                // Save state to localStorage
                const isCollapsed = chestDropdown.classList.contains('collapsed');
                localStorage.setItem('chestDropdownCollapsed', isCollapsed);

                // Close the menu if it's open when collapsing
                if (isCollapsed) {
                    document.getElementById('chest-menu').classList.remove('show');
                    expandToggle.textContent = 'Show Advanced Filters';
                }
            }

            populateChests() {
                // Clear existing mappings
                for (let chest in this.chestMappings) {
                    this.chestMappings[chest] = [];
                }

                // Map items to chests based on their descriptions
                this.items.forEach(item => {
                    const from = (item.from || '').toLowerCase();
                    const name = item.name.toLowerCase();
                    let assignedChest = null;

                    // Check for specific chest mentions
                    if (from.includes('item crate')) {
                        assignedChest = 'itemcrate';
                    } else if (from.includes('lucky chest')) {
                        assignedChest = 'luckychest';
                    } else if (from.includes('mystery bag')) {
                        assignedChest = 'mysterybag';
                    } else if (from.includes('typical chest')) {
                        assignedChest = 'typicalchest';
                    } else if (from.includes('premium chest')) {
                        assignedChest = 'premiumchest';
                    } else if (from.includes('steel chest')) {
                        assignedChest = 'steelchest';
                    } else if (from.includes('elusive bag')) {
                        assignedChest = 'elusivebag';
                    } else if (from.includes('legendary chest')) {
                        assignedChest = 'legendarychest';
                    } else if (from.includes('epic chest')) {
                        assignedChest = 'epicchest';
                    } else if (from.includes('birthday chest')) {
                        assignedChest = 'birthdaychest';
                    } else if (from.includes('daily rewards')) {
                        assignedChest = 'dailyrewards';
                    } else if (from.includes('1hr playtime rewards')) {
                        assignedChest = '1hrplaytime';
                    }



                    // Add item to chest mapping
                    if (assignedChest) {
                        this.chestMappings[assignedChest].push(item.name);
                        // Store chest association on the item itself for filtering
                        item.chest = assignedChest;
                    } else {
                        // Items without specific chest assignment
                        item.chest = 'all';
                    }
                });
            }

            selectSeason(season) {
                this.seasonFilter = season;
                document.getElementById('season-label').textContent = season === 'all' ? 'All' : `${season}`;
                document.querySelectorAll('#season-menu .dropdown-item').forEach(item => {
                    item.classList.toggle('active', item.dataset.season == season);
                });

                this.toggleSeason(); // Close dropdown
                this.applyFilters();
            }

            toggleSort() {
                const menu = document.getElementById('sort-menu');
                menu.classList.toggle('show');
            }

            toggleSeason() {
                const menu = document.getElementById('season-menu');
                menu.classList.toggle('show');
            }

            selectSort(sortType) {
                this.sortBy = sortType;
                const labels = {
                    'default': 'Default',
                    'price-asc': '$ ‚ûî $$$',
                    'price-desc': '$$$ ‚ûî $',
                    'name-asc': 'A ‚ûî Z',
                    'name-desc': 'Z ‚ûî A'
                };
                document.getElementById('sort-label').textContent = labels[sortType];

                document.querySelectorAll('#sort-menu .dropdown-item').forEach(item => {
                    item.classList.toggle('active', item.dataset.sort === sortType);
                });

                this.toggleSort(); // Close dropdown
                this.applyFilters();
            }

            setupEventListeners() {

                // Close menus when clicking outside
                document.addEventListener('click', (e) => {
                    if (!e.target.closest('.chest-dropdown')) {
                        document.getElementById('chest-menu').classList.remove('show');
                    }
                    if (!e.target.closest('.sort-dropdown')) {
                        document.getElementById('sort-menu').classList.remove('show');
                    }
                    if (!e.target.closest('.season-dropdown')) {
                        document.getElementById('season-menu').classList.remove('show');
                    }
                });

                // Sort dropdown items
                document.querySelectorAll('#sort-menu .dropdown-item').forEach(item => {
                    item.addEventListener('click', () => {
                        this.selectSort(item.dataset.sort);
                    });
                });

                // Filter chips
                document.querySelectorAll('.filter-chip').forEach(chip => {
                    chip.addEventListener('click', () => {
                        chip.classList.toggle('active');
                        const filter = chip.dataset.filter;

                        if (this.filters.tags.has(filter)) {
                            this.filters.tags.delete(filter);
                        } else {
                            this.filters.tags.add(filter);
                        }

                        this.applyFilters();
                    });
                });

                // Search with recent items
                const searchBar = document.getElementById('search-bar');
                let searchTimeout;

                searchBar.addEventListener('focus', () => {
                    this.showRecentItems();
                });

                searchBar.addEventListener('blur', () => {
                    setTimeout(() => {
                        document.getElementById('recent-items').classList.remove('show');
                    }, 200);
                });

                searchBar.addEventListener('input', (e) => {
                    clearTimeout(searchTimeout);
                    searchTimeout = setTimeout(() => {
                        this.filters.search = e.target.value.toLowerCase();
                        this.applyFilters();
                    }, 300);
                });

                // Load more button
                document.getElementById('loadMore').addEventListener('click', () => {
                    this.loadBatch();
                });

                // Infinite scroll
                window.addEventListener('scroll', () => {
                    if (window.innerHeight + window.scrollY >= document.body.offsetHeight - 100) {
                        this.loadBatch();
                    }
                });

                // Keyboard navigation
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'ArrowLeft') {
                        this.prevCategory();
                    } else if (e.key === 'ArrowRight') {
                        this.nextCategory();
                    }
                });
            }

            showRecentItems() {
                if (this.recentlyViewed.length === 0) return;

                const recentDiv = document.getElementById('recent-items');
                recentDiv.innerHTML = '';

                const recent = this.recentlyViewed.slice(0, 5);
                recent.forEach(itemName => {
                    const item = this.items.find(i => i.name === itemName);
                    if (item) {
                        const div = document.createElement('div');
                        div.className = 'recent-item';
                        div.innerHTML = `
                            ${item.img ? `<img src="${item.img}" alt="${item.name}">` : '<div style="width:30px;height:30px;background:#666;border-radius:5px;"></div>'}
                            <span>${item.name}</span>
                        `;
                        div.onclick = () => {
                            document.getElementById('search-bar').value = item.name;
                            this.filters.search = item.name.toLowerCase();
                            this.applyFilters();
                            recentDiv.classList.remove('show');
                        };
                        recentDiv.appendChild(div);
                    }
                });

                recentDiv.classList.add('show');
            }

            applyFilters() {
                this.filtered = this.items.filter(item => {
                    // Chest filter
                    if (this.chestFilter !== 'all') {
                        // Check if item is in the selected chest's mapping
                        const chestItems = this.chestMappings[this.chestFilter] || [];
                        if (!chestItems.includes(item.name) && item.chest !== this.chestFilter) {
                            return false;
                        }
                    }

                    // Category filter
                    if (this.filters.category !== 'all' && item.category !== this.filters.category) {
                        return false;
                    }

                    // Season filter
                    if (this.seasonFilter !== 'all' && item.seasons && !item.seasons.includes(this.seasonFilter)) {
                        return false;
                    }

                    // Search filter
                    if (this.filters.search && !item.name.toLowerCase().includes(this.filters.search)) {
                        return false;
                    }

                    // Tag filters
                    for (let tag of this.filters.tags) {
                        switch (tag) {
                            case 'new':
                                if (!item.new) return false;
                                break;
                            case 'untradable':
                                if (item.tradable !== false) return false;
                                break;
                            case 'premium':
                                if (!item.premium) return false;
                                break;
                            case 'gamenight':
                                if (!item.from.toLowerCase().includes('gamenight')) return false;
                                break;
                            case 'unreleased':
                                if (!item.from.toLowerCase().includes('unreleased')) return false;
                                break;
                            case 'retired':
                                if (!item.retired) return false;
                                break;
                            case 'favorites':
                                if (!this.favorites.includes(item.name)) return false;
                                break;
                            case 'wishlist':
                                if (!this.wishlist.includes(item.name)) return false;
                                break;
                        }
                    }

                    return true;
                });

                // Apply sorting
                this.sortItems();

                // Reset display
                this.currentBatch = 0;
                this.displayed = [];
                document.getElementById('catalog').innerHTML = '';

                // Load first batch
                this.loadBatch();

                // Update chest label with item count
                if (this.chestFilter !== 'all') {
                    const chestCount = this.filtered.length;
                    const selectedChest = document.querySelector(`.chest-item[data-chest="${this.chestFilter}"] .chest-name`);
                    if (selectedChest) {
                        document.getElementById('chest-label').textContent = `${selectedChest.textContent} (${chestCount})`;
                    }
                }
            }

            sortItems() {
                switch (this.sortBy) {
                    case 'price-asc':
                        this.filtered.sort((a, b) => {
                            const priceA = a.price?.toLowerCase() === 'o/c' ? Number.MAX_SAFE_INTEGER : (parseInt(a.price || 0) || Number.MAX_SAFE_INTEGER);
                            const priceB = b.price?.toLowerCase() === 'o/c' ? Number.MAX_SAFE_INTEGER : (parseInt(b.price || 0) || Number.MAX_SAFE_INTEGER);
                            return priceA - priceB;
                        });
                        break;
                    case 'price-desc':
                        this.filtered.sort((a, b) => {
                            const priceA = a.price?.toLowerCase() === 'o/c' ? Number.MAX_SAFE_INTEGER : (parseInt(a.price || 0) || 0);
                            const priceB = b.price?.toLowerCase() === 'o/c' ? Number.MAX_SAFE_INTEGER : (parseInt(b.price || 0) || 0);
                            return priceB - priceA;
                        });
                        break;
                    case 'name-asc':
                        this.filtered.sort((a, b) => a.name.localeCompare(b.name));
                        break;
                    case 'name-desc':
                        this.filtered.sort((a, b) => b.name.localeCompare(a.name));
                        break;
                    default:
                        // Keep original order
                        break;
                }
            }

            loadBatch() {
                if (this.loading) return;
                const start = this.currentBatch * this.batchSize;
                const end = start + this.batchSize;
                const batch = this.filtered.slice(start, end);

                if (batch.length === 0) {
                    document.getElementById('loadMore').disabled = true;
                    document.getElementById('loadMore').textContent = 'No more items';
                    return;
                }

                this.loading = true;
                document.getElementById('loadMore').disabled = true;
                document.getElementById('loadMore').innerHTML = '<div class="loading-spinner"></div>';

                setTimeout(() => {
                    batch.forEach(item => {
                        this.displayed.push(item);
                        this.renderItem(item);
                    });
                    scrollTo(0, scroll);

                    this.currentBatch++;
                    this.loading = false;

                    document.getElementById('showing').textContent = this.displayed.length;

                    if (this.displayed.length >= this.filtered.length) {
                        document.getElementById('loadMore').textContent = 'All items loaded';
                        document.getElementById('loadMore').disabled = true;
                    } else {
                        document.getElementById('loadMore').textContent = 'Load More Items';
                        document.getElementById('loadMore').disabled = false;
                    }
                }, 300);
            }




            renderItem(data) {
                const item = document.createElement('div');
                item.className = 'item';

                const colors = {
                    gears: '#5bfe6a',
                    deaths: '#ff7a5e',
                    titles: '#c960fe',
                    pets: '#377afa',
                    effects: '#ffb135'
                };
                item.style.backgroundColor = colors[data.category] || 'transparent';



                if (data.img) {
                    const img = document.createElement('img');
                    img.src = data.img;
                    img.loading = 'lazy';
                    item.appendChild(img);
                } else if (data.svg) {
                    item.innerHTML = data.svg;
                }

                // Add name
                const name = document.createElement('div');
                name.className = 'item-name';
                name.textContent = data.name;
                item.appendChild(name);

                // Add price
                if (data.price && data.price !== 'N/A') {
                    const price = document.createElement('div');
                    price.className = 'item-price';
                    price.innerHTML = `<svg style="width: 13px;" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16.6 18"><path d="M6.251 6.993v3.999h4.025V6.99Zm-.156-4.689c1.917-1.213 2.507-1.154 4.484.034l3.37 2.027c.648.43 1.255.949 1.157 2.077v4.444c.009 1.578-.127 2.032-1.065 2.656l-3.492 2.052c-2.118 1.195-2.219 1.353-4.55.001l-3.28-1.913c-.886-.562-1.373-1.115-1.315-2.45V6.733c-.025-1.63.458-1.874 1.242-2.405Zm.395 1.298c1.287-.804 1.855-1.088 3.612.034l2.777 1.641c.568.423.954.838.96 1.652v3.952c-.007.705-.271 1.405-.9 1.77l-2.813 1.684c-1.786.942-1.799 1.004-3.127.287l-3.22-1.835c-.658-.474-1.038-.651-1.006-2.009V7.131c.005-1.044.193-1.432.991-1.952ZM5.605.944C7.71-.331 8.871-.345 11.011.985l4.062 2.444c.646.363 1.512 1.515 1.528 2.588v5.847c.003 1.055-.645 2.014-1.424 2.63l-4.178 2.501c-1.843 1.087-3.052 1.56-5.486.002l-3.928-2.348C.71 14.043-.006 13.267 0 11.695V6.272c.033-1.551.668-2.233 1.498-2.899Z" fill="#fff" fill-rule="evenodd"></path></svg>${this.formatPrice(data.price)}`;
                    item.appendChild(price);
                }

                // Add badges
                if (data.premium) {
                    const badge = document.createElement('img');
                    badge.className = 'badge premium';
                    badge.src = './imgs/prem.png';
                    badge.title = 'Roblox Premium';
                    item.appendChild(badge);
                }

                if (data.retired) {
                    const badge = document.createElement('div');
                    badge.className = 'badge retired';
                    badge.innerText = 'Retired';
                    item.appendChild(badge);
                }

                if (data.from.toLowerCase().includes('unreleased') || data.from.toLowerCase().includes('@zarabelle') || data.from.toLowerCase().includes('@typicaltype')) {
                    const badge = document.createElement('div');
                    badge.className = 'badge staff';
                    badge.title = 'Staff/Unreleased';
                    badge.innerHTML = '<svg viewBox="0 0 36 36" xmlns="http://www.w3.org/2000/svg"><defs><linearGradient id="a" x2="0" y2="100%"><stop style="stop-color:#d5d5d5"/><stop offset=".3" style="stop-color:#6b6b6b"/><stop offset=".4" style="stop-color:#6b6b6b"/><stop offset=".5" style="stop-color:#3b3b3b"/><stop offset=".6" style="stop-color:#3b3b3b"/><stop offset=".9" style="stop-color:#0c0c0c"/></linearGradient></defs><path stroke="#000" fill="url(#a)" d="M31.25 7.4a44 44 0 0 1-6.62-2.35 45 45 0 0 1-6.08-3.21L18 1.5l-.54.35a45 45 0 0 1-6.08 3.21A44 44 0 0 1 4.75 7.4L4 7.59v8.34c0 13.39 13.53 18.4 13.66 18.45l.34.12.34-.12c.14 0 13.66-5.05 13.66-18.45V7.59Z"/></svg>';
                    item.appendChild(badge);
                }

                if (data.new) {
                    const badge = document.createElement('img');
                    badge.className = 'badge new';
                    badge.src = './imgs/new.png';
                    item.appendChild(badge);
                }

                if (!data.tradable) {
                    const badge = document.createElement('img');
                    badge.className = 'badge untradable';
                    badge.title = 'Untradable';
                    badge.src = './imgs/WLjbELh.png';
                    item.appendChild(badge);
                }

                // Add wishlist button
                const wishlistBtn = document.createElement('div');
                wishlistBtn.className = 'wishlist-button';

                wishlistBtn.textContent = '‚≠ê';
                if (this.wishlist.includes(data.name)) {
                    wishlistBtn.classList.add('active');
                }
                wishlistBtn.onclick = (e) => {
                    e.stopPropagation();
                    this.toggleWishlist(data.name);
                    const rect = wishlistBtn.getBoundingClientRect();
                    wishlistBtn.classList.toggle('active');
                };
                wishlistBtn.title = this.wishlist.includes(data.name) ? 'Remove from Wishlist' : 'Add to Wishlist';
                item.appendChild(wishlistBtn);

                // Add favorite button with particle effect
                const heart = document.createElement('div');
                heart.className = 'heart-button';
                heart.textContent = this.favorites.includes(data.name) ? '‚ù§Ô∏è' : 'ü§ç';
                if (this.favorites.includes(data.name)) {
                    heart.classList.add('red');
                }
                heart.onclick = (e) => {
                    e.stopPropagation();

                    // Create particles at click position
                    const rect = heart.getBoundingClientRect();
                    this.createParticles(rect.left + rect.width / 2, rect.top + rect.height / 2);

                    this.toggleFavorite(data.name);
                    heart.textContent = this.favorites.includes(data.name) ? '‚ù§Ô∏è' : 'ü§ç';
                    heart.classList.toggle('red');
                };
                item.appendChild(heart);

                // Click to open modal
                item.onclick = () => {
                    this.openModal(data);
                };

                document.getElementById('catalog').appendChild(item);
            }

            formatPrice(price) {
                const num = parseInt(price);
                if (num >= 1000) {
                    return Math.floor(num / 1000) + 'k';
                }
                return price;
            }

            toggleFavorite(name) {
                const index = this.favorites.indexOf(name);
                if (index > -1) {
                    this.favorites.splice(index, 1);
                } else {
                    this.favorites.push(name);
                }
                this.saveToStorage('favorites', this.favorites);
            }

            toggleWishlist(name) {
                const index = this.wishlist.indexOf(name);
                if (index > -1) {
                    this.wishlist.splice(index, 1);
                } else {
                    this.wishlist.push(name);
                }
                this.saveToStorage('wishlist', this.wishlist);
                this.updateStatsIfOpen();
            }

            addToRecentlyViewed(name) {
                const index = this.recentlyViewed.indexOf(name);
                if (index > -1) {
                    this.recentlyViewed.splice(index, 1);
                }
                this.recentlyViewed.unshift(name);
                this.recentlyViewed = this.recentlyViewed.slice(0, 5); // Keep last 4
                this.saveToStorage('recentlyViewed', this.recentlyViewed);
            }

            openModal(item) {
                this.addToRecentlyViewed(item.name);
                const modal = document.getElementById('modal');
                const body = document.getElementById('modalBody');

                body.innerHTML = `
                    <h2>${item.name}</h2>
                    ${item.img ? `<img src="${item.img}" style="max-width: 100%; margin: 20px 0;">` : ''}
                    <p>${item.from || 'No description available'}</p>
                    ${item.price ? `<p><strong>Price:</strong> ${item.price}</p>` : ''}
                    ${item['price/code/rarity'] ? `<p>${item['price/code/rarity']}</p>` : ''}
                `;

                modal.classList.add('show');
            }

            closeModal() {
                document.getElementById('modal').classList.remove('show');
            }

            openStats() {
                document.getElementById('stats-dashboard').classList.add('show');
                this.updateStatsIfOpen();
            }

            closeStats() {
                document.getElementById('stats-dashboard').classList.remove('show');
            }

            updateStatsIfOpen() {
                if (!document.getElementById('stats-dashboard').classList.contains('show')) return;

                // Update wishlist
                const wishlistDiv = document.getElementById('wishlist-items');
                wishlistDiv.innerHTML = '';
                let totalValue = 0;

                this.wishlist.forEach(itemName => {
                    const item = this.items.find(i => i.name === itemName);
                    if (item) {
                        const div = document.createElement('div');
                        div.className = 'item';
                        div.innerHTML = `
                            ${item.img ? `<img src="${item.img}" alt="${item.name}">` : item.svg ? item.svg : '<div style="width:50px;height:50px;background:#666;border-radius:5px;"></div>'}
                            ${!item.svg ? `<div class="item-name">${item.name}</div>` : ''}
                            ${item.price != 'N/A' ? `<div class="item-price"><svg style="width: 13px;" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16.6 18"><path d="M6.251 6.993v3.999h4.025V6.99Zm-.156-4.689c1.917-1.213 2.507-1.154 4.484.034l3.37 2.027c.648.43 1.255.949 1.157 2.077v4.444c.009 1.578-.127 2.032-1.065 2.656l-3.492 2.052c-2.118 1.195-2.219 1.353-4.55.001l-3.28-1.913c-.886-.562-1.373-1.115-1.315-2.45V6.733c-.025-1.63.458-1.874 1.242-2.405Zm.395 1.298c1.287-.804 1.855-1.088 3.612.034l2.777 1.641c.568.423.954.838.96 1.652v3.952c-.007.705-.271 1.405-.9 1.77l-2.813 1.684c-1.786.942-1.799 1.004-3.127.287l-3.22-1.835c-.658-.474-1.038-.651-1.006-2.009V7.131c.005-1.044.193-1.432.991-1.952ZM5.605.944C7.71-.331 8.871-.345 11.011.985l4.062 2.444c.646.363 1.512 1.515 1.528 2.588v5.847c.003 1.055-.645 2.014-1.424 2.63l-4.178 2.501c-1.843 1.087-3.052 1.56-5.486.002l-3.928-2.348C.71 14.043-.006 13.267 0 11.695V6.272c.033-1.551.668-2.233 1.498-2.899Z" fill="#fff" fill-rule="evenodd"></path></svg>${this.formatPrice(item.price)}</div>` : ''}
                            <div class="remove-wishlist">√ó</div>
                        `;
                        div.querySelector('.remove-wishlist').onclick = (e) => {
                            e.stopPropagation();
                            this.toggleWishlist(item.name);
                        };
                        div.onclick = () => {
                            this.closeStats();
                            this.openModal(item);
                        };
                        wishlistDiv.appendChild(div);

                        if (item.price && item.price !== 'N/A') {
                            totalValue += parseInt(item.price) || 0;
                        }
                    }
                });

                document.getElementById('wishlist-value').textContent = this.formatPrice(totalValue);

                // Update recently viewed
                const recentDiv = document.getElementById('recent-viewed-items');
                recentDiv.innerHTML = '';

                this.recentlyViewed.slice(0, 5).forEach(itemName => {
                    const item = this.items.find(i => i.name === itemName);
                    if (item) {
                        const div = document.createElement('div');
                        div.className = 'wishlist-item';
                        div.innerHTML = `
                             ${item.img ? `<img src="${item.img}" alt="${item.name}">` : item.svg ? item.svg : '<div style="width:50px;height:50px;background:#666;border-radius:5px;"></div>'}
                            ${!item.svg ? `<div style="font-size:10px;margin-top:5px;">${item.name}</div>` : ''}
                            ${item.price != 'N/A' ? `<div class="item-price"><svg style="width: 13px;" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16.6 18"><path d="M6.251 6.993v3.999h4.025V6.99Zm-.156-4.689c1.917-1.213 2.507-1.154 4.484.034l3.37 2.027c.648.43 1.255.949 1.157 2.077v4.444c.009 1.578-.127 2.032-1.065 2.656l-3.492 2.052c-2.118 1.195-2.219 1.353-4.55.001l-3.28-1.913c-.886-.562-1.373-1.115-1.315-2.45V6.733c-.025-1.63.458-1.874 1.242-2.405Zm.395 1.298c1.287-.804 1.855-1.088 3.612.034l2.777 1.641c.568.423.954.838.96 1.652v3.952c-.007.705-.271 1.405-.9 1.77l-2.813 1.684c-1.786.942-1.799 1.004-3.127.287l-3.22-1.835c-.658-.474-1.038-.651-1.006-2.009V7.131c.005-1.044.193-1.432.991-1.952ZM5.605.944C7.71-.331 8.871-.345 11.011.985l4.062 2.444c.646.363 1.512 1.515 1.528 2.588v5.847c.003 1.055-.645 2.014-1.424 2.63l-4.178 2.501c-1.843 1.087-3.052 1.56-5.486.002l-3.928-2.348C.71 14.043-.006 13.267 0 11.695V6.272c.033-1.551.668-2.233 1.498-2.899Z" fill="#fff" fill-rule="evenodd"></path></svg>${this.formatPrice(item.price)}</div>` : ''}
                        `;
                        div.onclick = () => {
                            this.closeStats();
                            this.openModal(item);
                        };
                        recentDiv.appendChild(div);
                    }
                });
            }
        }
        // Eye tracking logic

        // Initialize
        const catalog = new Catalog();
    </script>
</body>

</html>