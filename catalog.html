<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Epic Catalogue - Clean Version</title>
    <link rel="stylesheet" href="./css/catalog.css?version=3.2">
    <link rel="manifest" href="/dev.webmanifest">
    <script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2"></script>
</head>
<div class="bn">
    üõ†Ô∏è Site updated May 31 ‚Äî <a style="color: #33c5ff;" href="#patchnotes">See
        what's new</a> ‚Äî All the items have been added!

    <button
        style="right: 15px;position: absolute;padding: 5px 10px;font-size: 17px;border-radius: 8px;background: transparent;border: none;cursor: pointer;"
        onclick="document.querySelector('.bn').remove()">x</button>
</div>

<body>
    <header>
        <a href="https://emwiki.site">
            <svg width="500" height="300" viewBox="451 471 100 39" xmlns="http://www.w3.org/2000/svg">
                <style>
                    @import url(https://emwiki.site/css/fonts.css);

                    @keyframes floatAnim {

                        0%,
                        to {
                            transform: translateY(0)
                        }

                        50% {
                            transform: translateY(-4px)
                        }
                    }

                    @keyframes glowPulse {

                        0%,
                        to {
                            filter: drop-shadow(0 0 0#fff)
                        }

                        50% {
                            filter: drop-shadow(0 0 8px #ff0) drop-shadow(0 0 15px #24ff5a)
                        }
                    }

                    @keyframes gradientShift {

                        0%,
                        to {
                            stop-color: #ff0
                        }

                        50% {
                            stop-color: #24ff5a
                        }
                    }
                </style>
                <defs>
                    <linearGradient id="eppp1" y1="1" x2="0">
                        <stop offset=".2" style="stop-color:#ff0" />
                        <stop offset="1" style="stop-color:#24ff5a" />
                    </linearGradient>
                    <linearGradient id="eppp2" y1="1" x2="0">
                        <stop offset="0" style="stop-color:#24ff5d" />
                        <stop offset="1" style="stop-color:#ff0" />
                    </linearGradient>
                </defs>
                <image x="464" y="463" href="https://emwiki.site/imgs/TWOKPhY.png" height="60" width="60"
                    style="filter:opacity(.6)" /><text x="489" y="503" text-anchor="middle" stroke="#000"
                    stroke-width="2.3" paint-order="stroke" stroke-linejoin="round" fill="url(#eppp1)"
                    style="animation:floatAnim 12s ease-in-out infinite;font:200 46px Bunny Flowers">Epic</text>
                <g
                    style="scale:.39;transform:translate(1592px,697px);rotate:20deg;transform-origin:center;animation:floatAnim2 15s ease-in-out 1s infinite alternate">
                    <circle cy="37.5" cx="36" r="35.5" />
                    <circle cy="37.5" cx="36" r="33" fill="#fede58" />
                    <path
                        d="M32.5 66.5c-12-2-19.5-11.5-21-23.5v-.5H9l-.5-2H57c.5 1.5 1 2.5 1 4C59.5 54 54.5 59 46.5 64c-4.5 2-9 3-14 2.5" />
                    <path
                        d="M37 64.5c5.5-.5 10-2.5 14-6 3-2.5 4.5-5.5 5-8.5.5-2 0-6-.5-7l-42-.5c-.5 6 3.5 12 7 16 3.5 3.5 7.5 5 12 6 1 .5 3.5.5 4.5 0"
                        fill="#871945" />
                    <path d="M7.5 34C2 10 29 12 25.5 32l-.5 2Z" />
                    <path
                        d="M23.5 32.5c.5-1 .5-4 0-6 0-1.5-.5-1.5-1-1-1.5 1.5-3.5 1.5-5 0-1.5-2-1.5-4 .5-5.5l.5-.5c-.5-1.5-8.5-2.5-10 7-.5 1.5 0 5 .5 6z"
                        fill="#fff" />
                    <path d="M38 34.5C35 21 42 18 45.5 17c3-.5 5.5 0 8 1.5 2.5 2 4.5 5 5 8.5 0 5.5-.5 7-.5 7.5Z" />
                    <path
                        d="M56.5 32.5c.5-.5.5-3.5.5-5-.5-1.5-.5-2.5-1-2.5l-.5.5c-1.5 1.5-4.5 1.5-6-1-.5-1.5 0-3 1-4 .5-.5.5-1 .5-1s0-.5-.5-.5c-5-1.5-10.5 2-11.5 8-.5 1.5 0 4.5.195 5.503Z"
                        fill="#fff" />
                    <path d="M48.883 60.176S45.5 63 39.5 64.5c-6.5 1.5-11-1-11-1s1-7.5 9-9.5c7.5-1.5 13 5 13 5Z"
                        fill="#f9bedd" />
                </g>
                <image x="495" y="478" href="https://emwiki.site/imgs/8UUB0Gt.png" height="60" width="60"
                    style="filter:opacity(.86)" /><text x="516" y="514" text-anchor="middle" stroke="#000"
                    stroke-width="2.3" paint-order="stroke" stroke-linejoin="round" fill="url(#eppp2)"
                    style="animation:floatAnim 12s ease-in-out infinite;animation-delay:5.5s;font:200 16px Bunny Flowers">Catalogue</text>
                <image x="438" y="489" href="https://emwiki.site/imgs/oYKd3nJ.png" height="28" width="42"
                    style="filter:opacity(.9)" />
            </svg>
        </a>
        <div class="theme-toggle" onclick="catalog.toggleTheme()"></div>
    </header>

    <!-- Controls Bar -->
    <div class="controls-bar">
        <div class="controls-row">
            <!-- Search with Recent Items -->
            <div class="search-wrapper">
                <input id="search-bar" type="text" placeholder="Search items..." />
                <div id="recent-items" class="recent-items"></div>
            </div>

            <!-- Sort Dropdown -->
            <div class="sort-dropdown">
                <button class="dropdown-btn" onclick="catalog.toggleSort()">
                    <span>Sort:</span> <span id="sort-label">Default</span> ‚ñº
                </button>
                <div id="sort-menu" class="dropdown-content">
                    <div class="dropdown-item" data-sort="default">Default</div>
                    <div class="dropdown-item" data-sort="price-asc">Price: Low to High</div>
                    <div class="dropdown-item" data-sort="price-desc">Price: High to Low</div>
                    <div class="dropdown-item" data-sort="name-asc">Name: A-Z</div>
                    <div class="dropdown-item" data-sort="name-desc">Name: Z-A</div>
                </div>
            </div>

            <!-- Season Filter -->
            <div class="season-dropdown">
                <button class="dropdown-btn" onclick="catalog.toggleSeason()">
                    <span>Season:</span> <span id="season-label">All</span> ‚ñº
                </button>
                <div id="season-menu" class="dropdown-content">
                    <div class="dropdown-item active" data-season="all">All Seasons</div>
                </div>
            </div>

            <!-- Stats Dashboard -->
            <button class="stats-btn" onclick="catalog.openStats()">üìä Dashboard</button>
        </div>
    </div>

    <!-- Category Carousel -->
    <div class="category-carousel-container">
        <div class="category-carousel" id="categoryCarousel"></div>
        <div class="carousel-nav prev" onclick="catalog.prevCategory()"></div>
        <div class="carousel-nav next" onclick="catalog.nextCategory()"></div>
    </div>

    <!-- Filter Pills -->
    <div class="filters-container">
        <div class="filters">
            <button class="filter-chip" data-filter="new">üÜï New</button>
            <button class="filter-chip" data-filter="untradable">üí± Untradable</button>
            <button class="filter-chip" data-filter="premium">üëë Premium</button>
            <button class="filter-chip" data-filter="retired">üö´ Retired</button>
            <button class="filter-chip" data-filter="favorites">‚ù§Ô∏è Favorites</button>
        </div>
    </div>

    <!-- Stats -->
    <div class="stats">
        Showing <span id="showing">0</span><span id="total">0</span> items
    </div>

    <!-- Catalog -->
    <div class="catalog-container">
        <div id="catalog" class="catalog-grid"></div>
        <div class="load-more">
            <button id="loadMore" class="load-button">Load More Items</button>
        </div>
    </div>

    <!-- Stats Dashboard Modal -->
    <div id="stats-dashboard" class="stats-dashboard">
        <div class="stats-content">
            <div class="stats-header">
                <h2>üìä Your Dashboard</h2>
                <span class="close-stats" onclick="catalog.closeStats()">√ó</span>
            </div>

            <div class="wishlist-section">
                <h3>‚≠ê Wishlist</h3>
                <div id="wishlist-items" class="wishlist-items"></div>
                <div class="wishlist-total">
                    Total Value: <span id="wishlist-value">0</span> coins
                </div>
            </div>

            <div class="recent-section">
                <h3>üëÄ Recently Viewed</h3>
                <div id="recent-viewed-items" class="wishlist-items"></div>
            </div>
        </div>
    </div>

    <!-- Item Modal -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="catalog.closeModal()">√ó</span>
            <div id="modalBody"></div>
        </div>
    </div>

    <!-- Particle Canvas -->
    <canvas id="particle-canvas"></canvas>

    <button
        style="margin-left: 15px; padding: 5px 10px; border-radius: 8px; background: #33c5ff; border: none; cursor: pointer;"
        onclick="window.location.href='https://emwiki.site/admin.html'">Admin</button>

    <script>
        // Clean, simple catalog system
        class Catalog {
            constructor() {
                this.items = [];
                this.filtered = [];
                this.displayed = [];
                this.batchSize = 50;
                this.currentBatch = 0;
                this.loading = false;
                this.currentCategoryIndex = 0;
                this.sortBy = 'default';
                this.seasonFilter = 'all';
                this.seasons = new Set();

                this.categories = [
                    { id: 'all', name: 'All', img: null, color: '#667eea' },
                    { id: 'gears', name: 'Gears', img: './imgs/AYUbTJv.png', color: '#5bfe6a' },
                    { id: 'deaths', name: 'Deaths', img: './imgs/fADZwOh.png', color: '#ff7a5e' },
                    { id: 'pets', name: 'Pets', img: './imgs/GHXB0nC.png', color: '#377afa' },
                    { id: 'effects', name: 'Effects', img: './imgs/l90cgxf.png', color: '#ffb135' },
                    { id: 'titles', name: 'Titles', img: './imgs/ZOP8l9g.png', color: '#c960fe' }
                ];

                this.filters = {
                    category: 'all',
                    tags: new Set(),
                    search: ''
                };

                this.favorites = this.loadFromStorage('favorites', []);
                this.wishlist = this.loadFromStorage('wishlist', []);
                this.recentlyViewed = this.loadFromStorage('recentlyViewed', []);

                this.particleCanvas = document.getElementById('particle-canvas');
                this.particleCtx = this.particleCanvas.getContext('2d');
                this.particles = [];

                this.init();
            }

            async init() {
                this.setupParticleCanvas();
                this.loadTheme();
                this.renderCategoryCarousel();
                await this.loadData();
                this.setupEventListeners();
                this.applyFilters();
                this.loadBatch();
                this.populateSeasonFilter();
            }

            loadFromStorage(key, defaultValue) {
                try {
                    const stored = localStorage.getItem(key);
                    return stored ? JSON.parse(stored) : defaultValue;
                } catch (e) {
                    return defaultValue;
                }
            }

            saveToStorage(key, value) {
                try {
                    localStorage.setItem(key, JSON.stringify(value));
                } catch (e) {
                    console.error('Failed to save to localStorage:', e);
                }
            }

            loadTheme() {
                const theme = localStorage.getItem('theme') || 'dark';
                if (theme === 'light') {
                    document.body.classList.add('light-theme');
                }
            }

            toggleTheme() {
                document.body.classList.toggle('light-theme');
                const theme = document.body.classList.contains('light-theme') ? 'light' : 'dark';
                localStorage.setItem('theme', theme);
            }

            setupParticleCanvas() {
                this.resizeCanvas();
                window.addEventListener('resize', () => this.resizeCanvas());
                this.animateParticles();
            }

            resizeCanvas() {
                this.particleCanvas.width = window.innerWidth;
                this.particleCanvas.height = window.innerHeight;
            }

            createParticles(x, y, colors = ['#ff0000', '#ff4444', '#ff8888', '#ffaaaa']) {
                for (let i = 0; i < 20; i++) {
                    this.particles.push({
                        x: x,
                        y: y,
                        vx: (Math.random() - 0.5) * 8,
                        vy: (Math.random() - 0.5) * 8,
                        size: Math.random() * 3 + 2,
                        color: colors[Math.floor(Math.random() * colors.length)],
                        life: 1.0
                    });
                }
            }

            animateParticles() {
                this.particleCtx.clearRect(0, 0, this.particleCanvas.width, this.particleCanvas.height);

                for (let i = this.particles.length - 1; i >= 0; i--) {
                    const p = this.particles[i];

                    p.x += p.vx;
                    p.y += p.vy;
                    p.vy += 0.3; // Gravity
                    p.life -= 0.02;

                    if (p.life <= 0) {
                        this.particles.splice(i, 1);
                        continue;
                    }

                    this.particleCtx.globalAlpha = p.life;
                    this.particleCtx.fillStyle = p.color;
                    this.particleCtx.fillRect(p.x, p.y, p.size, p.size);
                }

                requestAnimationFrame(() => this.animateParticles());
            }
            renderCategoryCarousel() {
                const carousel = document.getElementById('categoryCarousel');

                // Create items only once
                if (!carousel.dataset.initialized) {
                    this.categories.forEach((cat, index) => {
                        const item = document.createElement('div');
                        item.className = 'category-item';
                        item.dataset.category = cat.id;

                        if (cat.img) {
                            const img = document.createElement('img');
                            img.src = cat.img;
                            img.alt = cat.name;
                            item.appendChild(img);
                        } else {
                            const icon = document.createElement('div');
                            icon.style.fontSize = '50px';
                            icon.textContent = '‚ú®';
                            item.appendChild(icon);
                        }

                        const label = document.createElement('span');
                        label.textContent = cat.name;
                        item.appendChild(label);

                        item.onclick = () => this.selectCategory(index);

                        carousel.appendChild(item);
                    });

                    carousel.dataset.initialized = "true";
                }

                // Update positions & active state
                const items = carousel.querySelectorAll('.category-item');
                const total = this.categories.length;

                items.forEach((item, index) => {
                    let relativePos = index - this.currentCategoryIndex;

                    // Wrap relativePos to shortest path (-N/2 .. N/2)
                    if (relativePos > total / 2) {
                        relativePos -= total;
                    } else if (relativePos < -total / 2) {
                        relativePos += total;
                    }

                    item.dataset.pos = relativePos;

                    if (index === this.currentCategoryIndex) {
                        item.classList.add('active');
                        item.style.borderColor = this.categories[index].color;
                        item.style.backgroundColor = this.categories[index].color + '33';
                    } else {
                        item.classList.remove('active');
                        item.style.borderColor = '';
                        item.style.backgroundColor = '';
                    }
                });

                return carousel;
            }

            selectCategory(index) {
                this.currentCategoryIndex = index;
                this.filters.category = this.categories[index].id;
                this.renderCategoryCarousel();
                this.applyFilters();
            }


            prevCategory() {
                if (this.currentCategoryIndex > 0) {
                    this.selectCategory(this.currentCategoryIndex - 1);
                }
            }

            nextCategory() {
                if (this.currentCategoryIndex < this.categories.length - 1) {
                    this.selectCategory(this.currentCategoryIndex + 1);
                }
            }

            async loadData() {
                try {
                    const response = await fetch('https://emwiki.site/api/gist-version');
                    const data = await response.json();
                    const parsed = JSON.parse(data.files?.['auto.json']?.content);

                    const categories = ['gears', 'deaths', 'titles', 'pets', 'effects'];

                    categories.forEach(cat => {
                        if (parsed[cat]) {
                            parsed[cat].forEach(item => {
                                // Extract season from description
                                let season = null;
                                if (item.from) {
                                    const seasonMatch = item.from.match(/Season (\d+)/i);
                                    if (seasonMatch) {
                                        season = parseInt(seasonMatch[1]);
                                        this.seasons.add(season);
                                    }
                                }

                                this.items.push({
                                    ...item,
                                    category: cat,
                                    season: season
                                });
                            });
                        }
                    });

                    document.getElementById('total').textContent = this.items.length;
                } catch (error) {
                    console.error('Failed to load data:', error);
                }
            }

            populateSeasonFilter() {
                const seasonMenu = document.getElementById('season-menu');
                const seasons = Array.from(this.seasons).sort((a, b) => b - a);

                seasons.forEach(season => {
                    const item = document.createElement('div');
                    item.className = 'dropdown-item';
                    item.dataset.season = season;
                    item.textContent = `Season ${season}`;
                    item.onclick = () => this.selectSeason(season);
                    seasonMenu.appendChild(item);
                });
            }

            selectSeason(season) {
                this.seasonFilter = season;
                document.getElementById('season-label').textContent = season === 'all' ? 'All' : `Season ${season}`;

                document.querySelectorAll('#season-menu .dropdown-item').forEach(item => {
                    item.classList.toggle('active', item.dataset.season == season);
                });

                this.toggleSeason(); // Close dropdown
                this.applyFilters();
            }

            toggleSort() {
                const menu = document.getElementById('sort-menu');
                menu.classList.toggle('show');
            }

            toggleSeason() {
                const menu = document.getElementById('season-menu');
                menu.classList.toggle('show');
            }

            selectSort(sortType) {
                this.sortBy = sortType;
                const labels = {
                    'default': 'Default',
                    'price-asc': 'Price: Low to High',
                    'price-desc': 'Price: High to Low',
                    'name-asc': 'Name: A-Z',
                    'name-desc': 'Name: Z-A'
                };
                document.getElementById('sort-label').textContent = labels[sortType];

                document.querySelectorAll('#sort-menu .dropdown-item').forEach(item => {
                    item.classList.toggle('active', item.dataset.sort === sortType);
                });

                this.toggleSort(); // Close dropdown
                this.applyFilters();
            }

            setupEventListeners() {
                // Sort dropdown items
                document.querySelectorAll('#sort-menu .dropdown-item').forEach(item => {
                    item.addEventListener('click', () => {
                        this.selectSort(item.dataset.sort);
                    });
                });

                // Filter chips
                document.querySelectorAll('.filter-chip').forEach(chip => {
                    chip.addEventListener('click', () => {
                        chip.classList.toggle('active');
                        const filter = chip.dataset.filter;

                        if (this.filters.tags.has(filter)) {
                            this.filters.tags.delete(filter);
                        } else {
                            this.filters.tags.add(filter);
                        }

                        this.applyFilters();
                    });
                });

                // Search with recent items
                const searchBar = document.getElementById('search-bar');
                let searchTimeout;

                searchBar.addEventListener('focus', () => {
                    this.showRecentItems();
                });

                searchBar.addEventListener('blur', () => {
                    setTimeout(() => {
                        document.getElementById('recent-items').classList.remove('show');
                    }, 200);
                });

                searchBar.addEventListener('input', (e) => {
                    clearTimeout(searchTimeout);
                    searchTimeout = setTimeout(() => {
                        this.filters.search = e.target.value.toLowerCase();
                        this.applyFilters();
                    }, 300);
                });

                // Load more button
                document.getElementById('loadMore').addEventListener('click', () => {
                    this.loadBatch();
                });

                // Infinite scroll
                window.addEventListener('scroll', () => {
                    if (window.innerHeight + window.scrollY >= document.body.offsetHeight - 500) {
                        this.loadBatch();
                    }
                });

                // Keyboard navigation
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'ArrowLeft') {
                        this.prevCategory();
                    } else if (e.key === 'ArrowRight') {
                        this.nextCategory();
                    }
                });
            }

            showRecentItems() {
                if (this.recentlyViewed.length === 0) return;

                const recentDiv = document.getElementById('recent-items');
                recentDiv.innerHTML = '';

                const recent = this.recentlyViewed.slice(0, 5);
                recent.forEach(itemName => {
                    const item = this.items.find(i => i.name === itemName);
                    if (item) {
                        const div = document.createElement('div');
                        div.className = 'recent-item';
                        div.innerHTML = `
                            ${item.img ? `<img src="${item.img}" alt="${item.name}">` : '<div style="width:30px;height:30px;background:#666;border-radius:5px;"></div>'}
                            <span>${item.name}</span>
                        `;
                        div.onclick = () => {
                            document.getElementById('search-bar').value = item.name;
                            this.filters.search = item.name.toLowerCase();
                            this.applyFilters();
                            recentDiv.classList.remove('show');
                        };
                        recentDiv.appendChild(div);
                    }
                });

                recentDiv.classList.add('show');
            }

            applyFilters() {
                this.filtered = this.items.filter(item => {
                    // Category filter
                    if (this.filters.category !== 'all' && item.category !== this.filters.category) {
                        return false;
                    }

                    // Season filter
                    if (this.seasonFilter !== 'all' && item.season != this.seasonFilter) {
                        return false;
                    }

                    // Search filter
                    if (this.filters.search && !item.name.toLowerCase().includes(this.filters.search)) {
                        return false;
                    }

                    // Tag filters
                    for (let tag of this.filters.tags) {
                        switch (tag) {
                            case 'new':
                                if (!item.new) return false;
                                break;
                            case 'untradable':
                                if (item.tradable !== false) return false;
                                break;
                            case 'premium':
                                if (!item.premium) return false;
                                break;
                            case 'retired':
                                if (!item.retired) return false;
                                break;
                            case 'favorites':
                                if (!this.favorites.includes(item.name)) return false;
                                break;
                            case 'wishlist':
                                if (!this.wishlist.includes(item.name)) return false;
                                break;
                        }
                    }

                    return true;
                });

                // Apply sorting
                this.sortItems();

                // Reset display
                this.currentBatch = 0;
                this.displayed = [];
                document.getElementById('catalog').innerHTML = '';

                // Load first batch
                this.loadBatch();
            }

            sortItems() {
                switch (this.sortBy) {
                    case 'price-asc':
                        this.filtered.sort((a, b) => {
                            const priceA = parseInt(a.price) || 0;
                            const priceB = parseInt(b.price) || 0;
                            return priceA - priceB;
                        });
                        break;
                    case 'price-desc':
                        this.filtered.sort((a, b) => {
                            const priceA = parseInt(a.price) || 0;
                            const priceB = parseInt(b.price) || 0;
                            return priceB - priceA;
                        });
                        break;
                    case 'name-asc':
                        this.filtered.sort((a, b) => a.name.localeCompare(b.name));
                        break;
                    case 'name-desc':
                        this.filtered.sort((a, b) => b.name.localeCompare(a.name));
                        break;
                    default:
                        // Keep original order
                        break;
                }
            }

            loadBatch() {
                if (this.loading) return;

                const start = this.currentBatch * this.batchSize;
                const end = start + this.batchSize;
                const batch = this.filtered.slice(start, end);

                if (batch.length === 0) {
                    document.getElementById('loadMore').disabled = true;
                    document.getElementById('loadMore').textContent = 'No more items';
                    return;
                }

                this.loading = true;
                document.getElementById('loadMore').disabled = true;
                document.getElementById('loadMore').innerHTML = '<div class="loading-spinner"></div>';

                setTimeout(() => {
                    batch.forEach(item => {
                        this.displayed.push(item);
                        this.renderItem(item);
                    });

                    this.currentBatch++;
                    this.loading = false;

                    document.getElementById('showing').textContent = this.displayed.length;

                    if (this.displayed.length >= this.filtered.length) {
                        document.getElementById('loadMore').textContent = 'All items loaded';
                        document.getElementById('loadMore').disabled = true;
                    } else {
                        document.getElementById('loadMore').textContent = 'Load More Items';
                        document.getElementById('loadMore').disabled = false;
                    }
                }, 300);
            }




            renderItem(data) {
                const item = document.createElement('div');
                item.className = 'item';

                const colors = {
                    gears: '#5bfe6a',
                    deaths: '#ff7a5e',
                    titles: '#c960fe',
                    pets: '#377afa',
                    effects: '#ffb135'
                };
                item.style.backgroundColor = colors[data.category] || 'transparent';



                if (data.img) {
                    const img = document.createElement('img');
                    img.src = data.img;
                    img.loading = 'lazy';
                    item.appendChild(img);
                } else if (data.svg) {
                    item.innerHTML = data.svg;
                }

                // Add name
                const name = document.createElement('div');
                name.className = 'item-name';
                name.textContent = data.name;
                item.appendChild(name);

                // Add price
                if (data.price && data.price !== 'N/A') {
                    const price = document.createElement('div');
                    price.className = 'item-price';
                    price.innerHTML = `<svg style="width: 13px;" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16.6 18"><path d="M6.251 6.993v3.999h4.025V6.99Zm-.156-4.689c1.917-1.213 2.507-1.154 4.484.034l3.37 2.027c.648.43 1.255.949 1.157 2.077v4.444c.009 1.578-.127 2.032-1.065 2.656l-3.492 2.052c-2.118 1.195-2.219 1.353-4.55.001l-3.28-1.913c-.886-.562-1.373-1.115-1.315-2.45V6.733c-.025-1.63.458-1.874 1.242-2.405Zm.395 1.298c1.287-.804 1.855-1.088 3.612.034l2.777 1.641c.568.423.954.838.96 1.652v3.952c-.007.705-.271 1.405-.9 1.77l-2.813 1.684c-1.786.942-1.799 1.004-3.127.287l-3.22-1.835c-.658-.474-1.038-.651-1.006-2.009V7.131c.005-1.044.193-1.432.991-1.952ZM5.605.944C7.71-.331 8.871-.345 11.011.985l4.062 2.444c.646.363 1.512 1.515 1.528 2.588v5.847c.003 1.055-.645 2.014-1.424 2.63l-4.178 2.501c-1.843 1.087-3.052 1.56-5.486.002l-3.928-2.348C.71 14.043-.006 13.267 0 11.695V6.272c.033-1.551.668-2.233 1.498-2.899Z" fill="#fff" fill-rule="evenodd"></path></svg>${this.formatPrice(data.price)}`;
                    item.appendChild(price);
                }

                // Add badges
                if (data.premium) {
                    const badge = document.createElement('img');
                    badge.className = 'badge premium';
                    badge.src = './imgs/prem.png';
                    item.appendChild(badge);
                }

                if (data.retired) {
                    const badge = document.createElement('div');
                    badge.className = 'badge retired';
                    badge.innerText = 'Retired';
                    item.appendChild(badge);
                }

                // Add wishlist button
                const wishlistBtn = document.createElement('div');
                wishlistBtn.className = 'wishlist-button';
                wishlistBtn.textContent = '‚≠ê';
                if (this.wishlist.includes(data.name)) {
                    wishlistBtn.classList.add('active');
                }
                wishlistBtn.onclick = (e) => {
                    e.stopPropagation();
                    this.toggleWishlist(data.name);
                    const rect = wishlistBtn.getBoundingClientRect();
                    wishlistBtn.classList.toggle('active');
                };
                item.appendChild(wishlistBtn);

                // Add favorite button with particle effect
                const heart = document.createElement('div');
                heart.className = 'heart-button';
                heart.textContent = this.favorites.includes(data.name) ? '‚ù§Ô∏è' : 'ü§ç';
                if (this.favorites.includes(data.name)) {
                    heart.classList.add('red');
                }
                heart.onclick = (e) => {
                    e.stopPropagation();

                    // Create particles at click position
                    const rect = heart.getBoundingClientRect();
                    this.createParticles(rect.left + rect.width / 2, rect.top + rect.height / 2);

                    this.toggleFavorite(data.name);
                    heart.textContent = this.favorites.includes(data.name) ? '‚ù§Ô∏è' : 'ü§ç';
                    heart.classList.toggle('red');
                };
                item.appendChild(heart);

                // Click to open modal
                item.onclick = () => {
                    this.openModal(data);
                };

                document.getElementById('catalog').appendChild(item);
            }

            formatPrice(price) {
                const num = parseInt(price);
                if (num >= 1000) {
                    return Math.floor(num / 1000) + 'k';
                }
                return price;
            }

            toggleFavorite(name) {
                const index = this.favorites.indexOf(name);
                if (index > -1) {
                    this.favorites.splice(index, 1);
                } else {
                    this.favorites.push(name);
                }
                this.saveToStorage('favorites', this.favorites);
            }

            toggleWishlist(name) {
                const index = this.wishlist.indexOf(name);
                if (index > -1) {
                    this.wishlist.splice(index, 1);
                } else {
                    this.wishlist.push(name);
                }
                this.saveToStorage('wishlist', this.wishlist);
                this.updateStatsIfOpen();
            }

            addToRecentlyViewed(name) {
                const index = this.recentlyViewed.indexOf(name);
                if (index > -1) {
                    this.recentlyViewed.splice(index, 1);
                }
                this.recentlyViewed.unshift(name);
                this.recentlyViewed = this.recentlyViewed.slice(0, 20); // Keep last 20
                this.saveToStorage('recentlyViewed', this.recentlyViewed);
            }

            openModal(item) {
                this.addToRecentlyViewed(item.name);
                const modal = document.getElementById('modal');
                const body = document.getElementById('modalBody');

                body.innerHTML = `
                    <h2>${item.name}</h2>
                    ${item.img ? `<img src="${item.img}" style="max-width: 100%; margin: 20px 0;">` : ''}
                    <p>${item.from || 'No description available'}</p>
                    ${item.price ? `<p><strong>Price:</strong> ${item.price}</p>` : ''}
                    ${item.season ? `<p><strong>Season:</strong> ${item.season}</p>` : ''}
                    ${item['price/code/rarity'] ? `<p>${item['price/code/rarity']}</p>` : ''}
                `;

                modal.classList.add('show');
            }

            closeModal() {
                document.getElementById('modal').classList.remove('show');
            }

            openStats() {
                document.getElementById('stats-dashboard').classList.add('show');
                this.updateStatsIfOpen();
            }

            closeStats() {
                document.getElementById('stats-dashboard').classList.remove('show');
            }

            updateStatsIfOpen() {
                if (!document.getElementById('stats-dashboard').classList.contains('show')) return;

                // Update wishlist
                const wishlistDiv = document.getElementById('wishlist-items');
                wishlistDiv.innerHTML = '';
                let totalValue = 0;

                this.wishlist.forEach(itemName => {
                    const item = this.items.find(i => i.name === itemName);
                    if (item) {
                        const div = document.createElement('div');
                        div.className = 'wishlist-item';
                        div.innerHTML = `
                            ${item.img ? `<img src="${item.img}" alt="${item.name}">` : '<div style="width:50px;height:50px;background:#666;border-radius:5px;"></div>'}
                            <div style="font-size:10px;margin-top:5px;">${item.name}</div>
                            <div class="remove-wishlist">√ó</div>
                        `;
                        div.querySelector('.remove-wishlist').onclick = (e) => {
                            e.stopPropagation();
                            this.toggleWishlist(item.name);
                        };
                        div.onclick = () => {
                            this.closeStats();
                            this.openModal(item);
                        };
                        wishlistDiv.appendChild(div);

                        if (item.price && item.price !== 'N/A') {
                            totalValue += parseInt(item.price) || 0;
                        }
                    }
                });

                document.getElementById('wishlist-value').textContent = this.formatPrice(totalValue);

                // Update recently viewed
                const recentDiv = document.getElementById('recent-viewed-items');
                recentDiv.innerHTML = '';

                this.recentlyViewed.slice(0, 6).forEach(itemName => {
                    const item = this.items.find(i => i.name === itemName);
                    if (item) {
                        const div = document.createElement('div');
                        div.className = 'wishlist-item';
                        div.innerHTML = `
                            ${item.img ? `<img src="${item.img}" alt="${item.name}">` : '<div style="width:50px;height:50px;background:#666;border-radius:5px;"></div>'}
                            <div style="font-size:10px;margin-top:5px;">${item.name}</div>
                        `;
                        div.onclick = () => {
                            this.closeStats();
                            this.openModal(item);
                        };
                        recentDiv.appendChild(div);
                    }
                });
            }
        }
        // Eye tracking logic

        // Initialize
        const catalog = new Catalog();
    </script>
</body>

</html>