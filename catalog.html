<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Epic Catalogue - Clean Version</title>
    <style>
        @import url("https://emwiki.site/css/fonts.css");

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-touch-callout: none;
            -webkit-tap-highlight-color: transparent;

        }

        body {
            background: #111;
            color: #fff;
            font-family: 'Source Sans Pro', Twemoji;
            overflow-x: hidden;
        }

        /* ============================================
           FILTER BAR - SIMPLE & STICKY
           ============================================ */
        .filter-bar {
            position: sticky;
            top: 0;
            z-index: 100;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .category-tabs {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }

        .tab {
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid transparent;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }

        .tab:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .tab.active {
            background: var(--tab-color, rgba(255, 255, 255, 0.3));
            border-color: var(--tab-color, #fff);
        }

        .filters {
            display: flex;
            gap: 8px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .filter-chip {
            padding: 5px 12px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .filter-chip.active {
            background: rgba(255, 255, 255, 0.2);
            border-color: #fff;
        }

        /* ============================================
           CATALOG GRID
           ============================================ */
        .catalog-container {
            min-height: 100vh;
            padding: 20px;
        }

        .catalog-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(125px, 1fr));
            gap: 23px 15px;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        .item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 6px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            height: 125px;
            width: 125px;
            box-shadow: 0 10px 30px transparent, inset -3px -3px 6px 0px #0000003b;
            display: flex;
            flex-direction: column;
            align-items: center;
            border: 1px outset #ffffff26;
            justify-content: space-between;

            @supports (corner-shape: squircle) {
                corner-shape: squircle;
                border-radius: 26px;
            }

        }



        .item:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.1);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5), inset -3px -3px 4px 0px #0000003b;

        }

        .item.loading {
            background: linear-gradient(90deg,
                    rgba(255, 255, 255, 0.05) 25%,
                    rgba(255, 255, 255, 0.1) 50%,
                    rgba(255, 255, 255, 0.05) 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
        }

        @keyframes shimmer {
            0% {
                background-position: 200% 0;
            }

            100% {
                background-position: -200% 0;
            }
        }

        .item>img,
        .item canvas,
        .item>svg {
            max-width: 80%;
            max-height: max-content;
            place-self: anchor-center;
            object-fit: contain;
            position: absolute;

        }

        .item-name {
            text-shadow: -1.3px -1.3px 0 #000, 0 -1.3px 0 #000, 1.3px -1.3px 0 #000, 1.3px 0 0 #000, 1.3px 1.3px 0 #000, 0 1.3px 0 #000, -1.3px 1.3px 0 #000, -1.3px 0 0 #000;
            z-index: 3;
            font-size: 12px;
            text-align: center;
            word-break: break-word;
        }

        button {
            color: #fff;
        }

        .item:has(>svg) .item-name {
            opacity: 0;
        }

        .item-price {
            border: 1px solid #ffffff61;
            display: flex;
            border-radius: 10px;
            gap: 4px;
            font: 1000 12px 'BuilderSans';
            color: #ffffff;
            background-color: #00000080;
            padding: 3px 6px;
            backdrop-filter: blur(6px);
            transition: filter 0.1s ease-out;
            filter: drop-shadow(2px 4px 6px transparent);
        }

        .item:hover .item-price {
            filter: drop-shadow(2px 4px 6px rgba(0, 0, 0, 0.479));
        }

        .item:hover .heart-button {
            opacity: 1;
        }

        .item-price img {
            width: 16px;
            height: 16px;
        }

        /* Badges */
        .badge {
            position: absolute;
            width: 20px;
            height: 20px;
        }

        .badge.premium {
            bottom: 6px;
            left: 7px;
            place-self: baseline;
        }

        .badge.retired {
            top: 5px;
            left: 5px;
        }

        .badge.new {
            bottom: 5px;
            right: 5px;
        }

        .heart-button {
            opacity: 0;
            position: absolute;
            top: -14px;
            right: -11px;
            font-size: 25px;
            cursor: pointer;
            z-index: 4;
            transition: all 0.2s, transform 0.4s cubic-bezier(.47, 1.64, .41, .8);
            text-shadow: -1.3px -1.3px 0 #000, 0 -1.3px 0 #000, 1.3px -1.3px 0 #000, 1.3px 0 0 #000, 1.3px 1.3px 0 #000, 0 1.3px 0 #000, -1.3px 1.3px 0 #000, -1.3px 0 0 #000;
        }

        .heart-button:hover {
            transform: scale(1.2) rotate(26deg);
        }

        .heart-button.red {
            transform: scale(1) rotate(26deg);
            opacity: 1;
            background: linear-gradient(to top, #730000, #ec2F4B);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: none;
            filter: drop-shadow(0px 0px 0.5px black) drop-shadow(0px 0px 0.5px black) drop-shadow(0px 0px 0.5px black) drop-shadow(0px 0px 0.5px black) drop-shadow(0px 0px 0.5px black);
        }

        .heart-button:active {
            transform: scale(.75) rotate(26deg);
        }




        /* ============================================
           LOAD MORE BUTTON
           ============================================ */
        .load-more {
            text-align: center;
            padding: 40px;
        }

        .load-button {
            padding: 12px 30px;
            background: transparent;
            border: none;
            color: white;
            font-size: 16px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .load-button:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }

        .load-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .loading-spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* ============================================
           MODAL - KEEP YOUR EXISTING STYLES
           ============================================ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: #222;
            border-radius: 15px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            position: relative;
        }

        .close-modal {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 30px;
            cursor: pointer;
            color: #fff;
        }

        /* Search bar */
        .search-wrapper {
            padding: 20px;
            background: #1a1a1a;
        }

        #search-bar {
            width: 100%;
            padding: 12px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: white;
            font-size: 16px;
        }

        #search-bar:focus {
            outline: none;
            border-color: #667eea;
        }

        .stats {
            text-align: center;
            padding: 10px;
            color: rgba(255, 255, 255, 0.6);
            font-size: 14px;
        }

        .stats {
            visibility: collapse;
        }

        .stats #showing,
        .stats #total {
            visibility: visible;
            color: #ffffffcc;
            font-weight: 600;
        }

        .stats:hover {
            visibility: visible;
        }

        .stats #total::before {
            content: " / ";
            color: #ffffffa8;
            font-weight: 100;
        }

        .stats:hover #total::before {
            content: " of ";
        }

        .badge.retired,
        .badge.retired:before,
        .badge.retired:after {
            box-sizing: border-box;
            -moz-box-sizing: border-box;
            -webkit-box-sizing: border-box;
        }

        .badge.retired {
            top: 23px;
            left: -1px;
            line-height: 0;
            font-variant: all-petite-caps;
            font-size: 12px;
            text-shadow: 0 0 2px black;
            padding: 0px 3px;
            position: absolute;
            width: 53px;
            height: 0;
            -webkit-transform: rotate(0deg) skew(0deg);
            transform: rotate(0deg) skew(0deg);
            border-top: 7px solid red;
            border-bottom: 7px solid red;
            border-right: 8px solid transparent;
        }

        @media screen and (max-width: 768px) {
            .item {
                width: 110px;
                height: 110px;
            }

            .catalog-grid {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));
                gap: 23px 10px;
                animation: fadeIn 0.5s;
            }
        }


        @media screen and (max-width: 400px) {
            .catalog-container {
                padding: 12px;
            }

            .catalog-grid {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
                gap: 23px 10px;
                animation: fadeIn 0.5s;
            }

            .item {
                width: 100px;
                height: 100px;
            }

        }
    </style>
</head>

<body>
    <!-- Search -->
    <div class="search-wrapper">
        <input id="search-bar" type="text" placeholder="Search items..." />
    </div>

    <!-- Filter Bar -->
    <div class="filter-bar">
        <div class="category-tabs">
            <button class="tab active" data-category="all">✨ All</button>
            <button class="tab" data-category="gears" style="--tab-color: #5bfe6a">⚙️ Gears</button>
            <button class="tab" data-category="deaths" style="--tab-color: #ff7a5e">💀 Deaths</button>
            <button class="tab" data-category="titles" style="--tab-color: #c960fe">🏷️ Titles</button>
            <button class="tab" data-category="pets" style="--tab-color: #377afa">🐾 Pets</button>
            <button class="tab" data-category="effects" style="--tab-color: #ffb135">✨ Effects</button>
        </div>

        <div class="filters">
            <button class="filter-chip" data-filter="new">🆕 New</button>
            <button class="filter-chip" data-filter="untradable">💱 Untradable</button>
            <button class="filter-chip" data-filter="premium">👑 Premium</button>
            <button class="filter-chip" data-filter="retired">🚫 Retired</button>
            <button class="filter-chip" data-filter="favorites">❤️ Favorites</button>
        </div>

        <div class="stats">
            Showing <span id="showing">0</span><span id="total">0</span> items
        </div>
    </div>

    <!-- Catalog -->
    <div class="catalog-container">
        <div id="catalog" class="catalog-grid"></div>

        <div class="load-more">
            <button id="loadMore" class="load-button">Load More Items</button>
        </div>
    </div>

    <!-- Modal -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="catalog.closeModal()">&times;</span>
            <div id="modalBody"></div>
        </div>
    </div>

    <script>
        // Clean, simple catalog system
        class Catalog {
            constructor() {
                this.items = [];
                this.filtered = [];
                this.displayed = [];
                this.batchSize = 50;
                this.currentBatch = 0;
                this.loading = false;

                this.filters = {
                    category: 'all',
                    tags: new Set(),
                    search: ''
                };

                this.favorites = this.loadFavorites();

                this.init();
            }

            async init() {
                await this.loadData();
                this.setupEventListeners();
                this.applyFilters();
                this.loadBatch();
            }

            async loadData() {
                // Simulate API call - replace with your actual data source
                try {
                    const response = await fetch('https://emwiki.site/api/gist-version');
                    const data = await response.json();
                    const parsed = JSON.parse(data.files?.['auto.json']?.content);

                    // Flatten all categories into one array
                    const categories = ['gears', 'deaths', 'titles', 'pets', 'effects'];

                    categories.forEach(cat => {
                        if (parsed[cat]) {
                            parsed[cat].forEach(item => {
                                this.items.push({
                                    ...item,
                                    category: cat
                                });
                            });
                        }
                    });

                    document.getElementById('total').textContent = this.items.length;
                } catch (error) {
                    console.error('Failed to load data:', error);
                    // Use fallback data if needed
                }
            }

            setupEventListeners() {
                // Category tabs
                document.querySelectorAll('.tab').forEach(tab => {
                    tab.addEventListener('click', () => {
                        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                        tab.classList.add('active');
                        this.filters.category = tab.dataset.category;
                        this.applyFilters();
                    });
                });

                // Filter chips
                document.querySelectorAll('.filter-chip').forEach(chip => {
                    chip.addEventListener('click', () => {
                        chip.classList.toggle('active');
                        const filter = chip.dataset.filter;

                        if (this.filters.tags.has(filter)) {
                            this.filters.tags.delete(filter);
                        } else {
                            this.filters.tags.add(filter);
                        }

                        this.applyFilters();
                    });
                });

                // Search
                const searchBar = document.getElementById('search-bar');
                let searchTimeout;
                searchBar.addEventListener('input', (e) => {
                    clearTimeout(searchTimeout);
                    searchTimeout = setTimeout(() => {
                        this.filters.search = e.target.value.toLowerCase();
                        this.applyFilters();
                    }, 300);
                });

                // Load more button
                document.getElementById('loadMore').addEventListener('click', () => {
                    this.loadBatch();
                });

                // Infinite scroll (optional - simpler implementation)
                window.addEventListener('scroll', () => {
                    if (window.innerHeight + window.scrollY >= document.body.offsetHeight - 500) {
                        this.loadBatch();
                    }
                });
            }

            applyFilters() {
                this.filtered = this.items.filter(item => {
                    // Category filter
                    if (this.filters.category !== 'all' && item.category !== this.filters.category) {
                        return false;
                    }

                    // Search filter
                    if (this.filters.search && !item.name.toLowerCase().includes(this.filters.search)) {
                        return false;
                    }

                    // Tag filters
                    for (let tag of this.filters.tags) {
                        switch (tag) {
                            case 'new':
                                if (!item.new) return false;
                                break;
                            case 'untradable':
                                if (item.tradable) return false;
                                break;
                            case 'premium':
                                if (!item.premium) return false;
                                break;
                            case 'retired':
                                if (!item.retired) return false;
                                break;
                            case 'favorites':
                                if (!this.favorites.includes(item.name)) return false;
                                break;
                        }
                    }

                    return true;
                });

                // Reset display
                this.currentBatch = 0;
                this.displayed = [];
                document.getElementById('catalog').innerHTML = '';

                // Load first batch
                this.loadBatch();
            }

            loadBatch() {
                if (this.loading) return;

                const start = this.currentBatch * this.batchSize;
                const end = start + this.batchSize;
                const batch = this.filtered.slice(start, end);

                if (batch.length === 0) {
                    document.getElementById('loadMore').disabled = true;
                    document.getElementById('loadMore').textContent = 'No more items';
                    return;
                }

                this.loading = true;
                document.getElementById('loadMore').disabled = true;
                document.getElementById('loadMore').innerHTML = '<div class="loading-spinner"></div>';

                // Simulate network delay for smooth loading
                setTimeout(() => {
                    batch.forEach(item => {
                        this.displayed.push(item);
                        this.renderItem(item);
                    });

                    this.currentBatch++;
                    this.loading = false;

                    document.getElementById('showing').textContent = this.displayed.length;

                    // Update button
                    if (this.displayed.length >= this.filtered.length) {
                        document.getElementById('loadMore').textContent = 'All items loaded';
                        document.getElementById('loadMore').disabled = true;
                    } else {
                        document.getElementById('loadMore').textContent = 'Load More Items';
                        document.getElementById('loadMore').disabled = false;
                    }
                }, 300);
            }

            renderItem(data) {
                const item = document.createElement('div');
                item.className = 'item';

                // Set category color
                const colors = {
                    gears: '#5bfe6a',
                    deaths: '#ff7a5e',
                    titles: '#c960fe',
                    pets: '#377afa',
                    effects: '#ffb135'
                };
                item.style.backgroundColor = colors[data.category] || 'transparent';




                // Add image
                if (data.img) {
                    const img = document.createElement('img');
                    img.src = data.img;
                    img.loading = 'lazy';
                    item.appendChild(img);
                } else if (data.svg) {
                    item.innerHTML = data.svg;
                }

                // Add name
                const name = document.createElement('div');
                name.className = 'item-name';
                name.textContent = data.name;
                item.appendChild(name);

                // Add price
                if (data.price && data.price !== 'N/A') {
                    const price = document.createElement('div');
                    price.className = 'item-price';
                    price.innerHTML = `<svg style="width: 13px;" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16.6 18" style="width: 16%;"><path d="M6.251 6.993v3.999h4.025V6.99Zm-.156-4.689c1.917-1.213 2.507-1.154 4.484.034l3.37 2.027c.648.43 1.255.949 1.157 2.077v4.444c.009 1.578-.127 2.032-1.065 2.656l-3.492 2.052c-2.118 1.195-2.219 1.353-4.55.001l-3.28-1.913c-.886-.562-1.373-1.115-1.315-2.45V6.733c-.025-1.63.458-1.874 1.242-2.405Zm.395 1.298c1.287-.804 1.855-1.088 3.612.034l2.777 1.641c.568.423.954.838.96 1.652v3.952c-.007.705-.271 1.405-.9 1.77l-2.813 1.684c-1.786.942-1.799 1.004-3.127.287l-3.22-1.835c-.658-.474-1.038-.651-1.006-2.009V7.131c.005-1.044.193-1.432.991-1.952ZM5.605.944C7.71-.331 8.871-.345 11.011.985l4.062 2.444c.646.363 1.512 1.515 1.528 2.588v5.847c.003 1.055-.645 2.014-1.424 2.63l-4.178 2.501c-1.843 1.087-3.052 1.56-5.486.002l-3.928-2.348C.71 14.043-.006 13.267 0 11.695V6.272c.033-1.551.668-2.233 1.498-2.899Z" fill="#fff" fill-rule="evenodd"></path></svg>${this.formatPrice(data.price)}`;
                    item.appendChild(price);
                }

                // Add badges
                if (data.premium) {
                    const badge = document.createElement('img');
                    badge.className = 'badge premium';
                    badge.src = './imgs/prem.png';
                    item.appendChild(badge);
                }

                if (data.retired) {
                    const badge = document.createElement('div');
                    badge.className = 'badge retired';
                    badge.innerText = 'Retired';
                    item.appendChild(badge);
                }

                // Add favorite button
                const heart = document.createElement('div');
                heart.className = 'heart-button';
                heart.textContent = this.favorites.includes(data.name) ? '❤️' : '🤍';
                this.favorites.includes(data.name) ? heart.classList.add('red') : heart.classList.remove('red');
                heart.onclick = (e) => {
                    e.stopPropagation();
                    this.toggleFavorite(data.name);
                    heart.textContent = this.favorites.includes(data.name) ? '❤️' : '🤍';
                    this.favorites.includes(data.name) ? heart.classList.add('red') : heart.classList.remove('red');
                };
                item.appendChild(heart);

                // Click to open modal
                item.onclick = () => this.openModal(data);

                document.getElementById('catalog').appendChild(item);
            }

            formatPrice(price) {
                const num = parseInt(price);
                if (num >= 1000) {
                    return Math.floor(num / 1000) + 'k';
                }
                return price;
            }

            openModal(item) {
                const modal = document.getElementById('modal');
                const body = document.getElementById('modalBody');

                body.innerHTML = `
                    <h2>${item.name}</h2>
                    ${item.img ? `<img src="${item.img}" style="max-width: 100%; margin: 20px 0;">` : ''}
                    <p>${item.from || 'No description available'}</p>
                    ${item.price ? `<p>Price: ${item.price}</p>` : ''}
                    ${item['price/code/rarity'] ? `<p>${item['price/code/rarity']}</p>` : ''}
                `;

                modal.classList.add('show');
            }

            closeModal() {
                document.getElementById('modal').classList.remove('show');
            }

            loadFavorites() {
                const stored = localStorage.getItem('favorites');
                return stored ? JSON.parse(stored) : [];
            }

            toggleFavorite(name) {
                const index = this.favorites.indexOf(name);
                if (index > -1) {
                    this.favorites.splice(index, 1);
                } else {
                    this.favorites.push(name);
                }
                localStorage.setItem('favorites', JSON.stringify(this.favorites));
            }
        }

        // Initialize
        const catalog = new Catalog();
    </script>
</body>

</html>