<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trading Hub - Epic Catalogue</title>
    <meta name="description" content="Trade Epic Minigames items with other players safely and easily!">
    <meta property="og:title" content="Trading Hub - Epic Catalogue">
    <meta property="og:image" content="https://emwiki.com/imgs/QgWIUWf.png">
    <link rel="stylesheet" href="./css/style.css">
    <link rel="icon" href="./imgs/favicon.png" type="image/png">
    <meta name="theme-color" content="#000000">

    <!-- Popover compatibility for older browsers -->
    <script src="./js/popover-loader.js"></script>

    <!-- SortableJS for drag and drop -->
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
</head>

<style>
    .trading-container {
        max-width: 1600px;
        margin: 0 auto;
        padding: 2rem;
        display: grid;
        grid-template-rows: 1fr auto;
        gap: 2rem;
        min-height: calc(100vh - 200px);
        animation: fadeInUp 0.5s ease-out;
    }

    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .all-items-section {
        background: linear-gradient(320deg, rgba(255, 255, 255, 0.03), #ffffff0d);
        border: 1px solid var(--border-color);
        border-radius: 20px;
        padding: 1.5rem;
        backdrop-filter: blur(10px);
        overflow: hidden;
        display: flex;
        flex-direction: column;
        min-height: 60vh;
        max-height: 70vh;
    }

    .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.25rem;
        gap: 1.5rem;
    }

    .section-title {
        font-size: 1.3rem;
        font-weight: 800;
        opacity: 0.95;
        background: linear-gradient(135deg, #667eea, #4a9eff);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    .search-box {
        flex: 1;
        max-width: 400px;
        position: relative;
    }

    .search-box::before {
        content: 'üîç';
        position: absolute;
        left: 1rem;
        top: 50%;
        transform: translateY(-50%);
        opacity: 0.5;
        pointer-events: none;
    }

    .search-input {
        width: 100%;
        padding: 0.75rem 1rem 0.75rem 2.75rem;
        background: var(--bg-item);
        border: 1px solid var(--border-color);
        border-radius: 12px;
        color: CanvasText;
        font-size: 0.95rem;
        transition: all 0.3s;
    }

    .search-input:focus {
        outline: none;
        background: var(--bg-item-hover);
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .category-filter {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
        margin-bottom: 1rem;
    }

    .category-pill {
        padding: 0.6rem 1.25rem;
        background: var(--bg-item);
        border: 1px solid var(--border-color);
        border-radius: 20px;
        color: CanvasText;
        font-size: 0.85rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
    }

    .category-pill::before {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        border-radius: 50%;
        background: rgba(102, 126, 234, 0.15);
        transform: translate(-50%, -50%);
        transition: width 0.4s, height 0.4s;
    }

    .category-pill:hover::before {
        width: 200%;
        height: 200%;
    }

    .category-pill:hover {
        background: var(--bg-item-hover);
        transform: translateY(-2px);
        box-shadow: 0 2px 8px var(--shadow-color);
    }

    .category-pill.active {
        background: linear-gradient(135deg, #667eea, #4a9eff);
        border-color: transparent;
        color: white;
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }

    .category-pill.active::before {
        display: none;
    }

    .items-grid2 {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));
        gap: 0.75rem;
        overflow-y: auto;
        padding: 0.5rem;
        flex: 1;
    }

    .items-grid2::-webkit-scrollbar {
        width: 8px;
    }

    .items-grid2::-webkit-scrollbar-thumb {
        background: var(--border-color);
        border-radius: 10px;
    }



    .item:active {
        cursor: grabbing;
        transform: scale(0.98);
    }

    .item.sortable-ghost {
        opacity: 0.3;
        transform: scale(0.95);
    }

    .item.sortable-drag {
        opacity: 0.9;
        transform: rotate(5deg) scale(1.05);
        cursor: grabbing;
        box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
    }


    .trade-panels {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 2rem;
        min-height: 0;
    }

    .trade-panel {
        background: var(--bg-item);
        border: 2px dashed var(--border-color);
        border-radius: 20px;
        padding: 1.5rem;
        display: flex;
        flex-direction: column;
        transition: all 0.3s;
    }

    .panel-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
        padding-bottom: 1rem;
        border-bottom: 1px solid var(--border-color);
    }

    .panel-title {
        font-size: 1.5rem;
        font-weight: 800;
        opacity: 0.9;
    }

    .r-button {
        width: 42px;
        height: 42px;
        background: linear-gradient(135deg, #667eea, #4a9eff);
        border: none;
        border-radius: 50%;
        color: white;
        font-size: 1.3rem;
        font-weight: 900;
        cursor: pointer;
        transition: all 0.3s;
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .r-button:hover {
        transform: scale(1.1) rotate(90deg);
        box-shadow: 0 6px 25px rgba(102, 126, 234, 0.5);
    }

    .r-button:active {
        transform: scale(0.95) rotate(90deg);
    }

    .panel-items {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
        gap: 0.75rem;
        flex: 1;
        overflow-y: auto;
        padding: 0.5rem;
        min-height: 200px;
        align-content: start;
    }

    .panel-items::-webkit-scrollbar {
        width: 6px;
    }

    .panel-items::-webkit-scrollbar-thumb {
        background: var(--border-color);
        border-radius: 10px;
    }

    .panel-items.empty::before {
        content: 'Drag items here';
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 1.2rem;
        font-weight: 600;
        opacity: 0.2;
        pointer-events: none;
        color: var(--text-secondary);
    }

    .panel-item {
        background: var(--bg-item-hover);
        border: 1px solid var(--border-color);
        border-radius: 12px;
        padding: 0.75rem;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 0.5rem;
        position: relative;
        animation: itemDrop 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        cursor: grab;
    }

    .panel-item:active {
        cursor: grabbing;
    }

    @keyframes itemDrop {
        from {
            opacity: 0;
            transform: scale(0.5) translateY(-20px);
        }

        to {
            opacity: 1;
            transform: scale(1) translateY(0);
        }
    }


    .custom-item {
        background: linear-gradient(135deg, rgba(17, 245, 74, 0.15), rgba(102, 126, 234, 0.15));
        border: 1px solid rgba(17, 245, 74, 0.3);
    }

    .custom-item-icon {
        width: 60px;
        height: 60px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2rem;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 8px;
        pointer-events: none;
    }

    .custom-item-text {
        font-size: 0.85rem;
        font-weight: 700;
        text-align: center;
        line-height: 1.3;
        pointer-events: none;
    }

    .trading-modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.85);
        backdrop-filter: blur(10px);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 1000;
        animation: fadeIn 0.2s;
    }

    .trading-modal-overlay.active {
        display: flex;
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
        }

        to {
            opacity: 1;
        }
    }

    .trading-modal-content {
        background: var(--bg-secondary);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 20px;
        padding: 2rem;
        max-width: 500px;
        width: 90%;
        animation: slideUp 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    @keyframes slideUp {
        from {
            opacity: 0;
            transform: translateY(50px) scale(0.9);
        }

        to {
            opacity: 1;
            transform: translateY(0) scale(1);
        }
    }

    .trading-modal-header {
        margin-bottom: 1.5rem;
    }

    .trading-modal-title {
        font-size: 1.5rem;
        font-weight: 800;
        margin-bottom: 0.5rem;
        color: var(--text-primary);
    }

    .trading-modal-subtitle {
        font-size: 0.9rem;
        opacity: 0.6;
        color: var(--text-secondary);
    }

    .trading-modal-body {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

    .trading-form-group {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
    }

    .trading-form-label {
        font-size: 0.9rem;
        font-weight: 600;
        opacity: 0.8;
        color: var(--text-primary);
    }

    .trading-form-input,
    .trading-form-textarea {
        padding: 0.75rem 1rem;
        background: var(--bg-item);
        border: 1px solid var(--border-color);
        border-radius: 12px;
        color: CanvasText;
        font-size: 0.95rem;
        font-family: inherit;
        transition: all 0.3s;
        resize: vertical;
    }

    .trading-form-input:focus,
    .trading-form-textarea:focus {
        outline: none;
        background: var(--bg-item-hover);
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .trading-modal-actions {
        display: flex;
        gap: 1rem;
        margin-top: 1rem;
    }


    .option-group {
        display: flex;
        gap: 0.75rem;
        margin-top: 0.5rem;
    }

    .option-btn {
        flex: 1;
        padding: 0.75rem;
        background: var(--bg-item);
        border: 1px solid var(--border-color);
        border-radius: 12px;
        color: CanvasText;
        font-size: 0.9rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        text-align: center;
    }

    .option-btn:hover {
        background: var(--bg-item-hover);
    }

    .option-btn.active {
        background: linear-gradient(135deg, #667eea, #4a9eff);
        border-color: transparent;
        color: white;
    }

    .hidden {
        display: none !important;
    }

    .load-more-container {
        display: flex;
        justify-content: center;
        padding: 1rem 0.5rem 0.5rem;
    }

    .load-more-btn {
        padding: 0.75rem 2rem;
        background: linear-gradient(135deg, #667eea, #4a9eff);
        border: none;
        border-radius: 12px;
        color: white;
        font-size: 0.95rem;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.3s;
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    }

    .load-more-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 25px rgba(102, 126, 234, 0.5);
    }

    .item img {
    max-width: 70%;
    max-height: 70%;
    object-fit: contain;
    position: absolute;
    pointer-events: none;
    place-self: anchor-center;
}

    .load-more-btn:active {
        transform: scale(0.95);
    }

    .load-more-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none;
    }

    .items-count {
        text-align: center;
        padding: 0.5rem;
        font-size: 0.85rem;
        opacity: 0.6;
    }

    /* Loading skeleton */
    .loading-skeleton {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
        gap: 0.75rem;
        padding: 0.5rem;
    }

    .skeleton-card {
        background: var(--bg-item);
        border: 1px solid var(--border-color);
        border-radius: 12px;
        padding: 0.85rem;
        height: 130px;
        animation: shimmer 2s infinite;
        background: linear-gradient(90deg,
                var(--bg-item) 0%,
                var(--bg-item-hover) 50%,
                var(--bg-item) 100%);
        background-size: 200% 100%;
    }

    @keyframes shimmer {
        0% {
            background-position: -200% 0;
        }

        100% {
            background-position: 200% 0;
        }
    }

    /* Empty state */
    .empty-state {
        grid-column: 1/-1;
        text-align: center;
        padding: 3rem 2rem;
        opacity: 0.6;
    }

    .empty-state-icon {
        font-size: 4rem;
        margin-bottom: 1rem;
        opacity: 0.5;
    }

    .empty-state-text {
        font-size: 1.1rem;
        font-weight: 600;
        margin-bottom: 0.5rem;
    }

    .empty-state-subtext {
        font-size: 0.9rem;
        opacity: 0.7;
    }

    /* Trade summary badge */
    .trade-summary {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 1rem;
        background: var(--bg-item);
        border: 1px solid var(--border-color);
        border-radius: 12px;
        font-size: 0.85rem;
        opacity: 0.8;
    }

    .trade-summary-count {
        font-weight: 700;
        color: #667eea;
    }


    @keyframes slideInRight {
        from {
            opacity: 0;
            transform: translateX(100px);
        }

        to {
            opacity: 1;
            transform: translateX(0);
        }
    }

    @media (max-width: 1024px) {
        .trade-panels {
            grid-template-columns: 1fr;
        }

        .trading-container {
            min-height: auto;
        }

        .items-grid2 {
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
        }
    }

    @media (max-width: 768px) {
        .trading-container {
            padding: 1rem;
            gap: 1rem;
        }

        .section-header {
            flex-direction: column;
            align-items: stretch;
        }

        .search-box {
            max-width: 100%;
        }

        .items-grid2,
        .panel-items {
            grid-template-columns: repeat(auto-fill, minmax(70px, 1fr));
            gap: 0.5rem;
        }
    }
</style>

<body>
    <!-- Header -->
    <header>
        <a href="https://emwiki.com">
            <svg width="500" height="300" viewBox="451 471 100 39" xmlns="http://www.w3.org/2000/svg">
                <defs>
                    <linearGradient id="eppp1" y1="1" x2="0">
                        <stop offset=".2" style="stop-color:#ff0" />
                        <stop offset="1" style="stop-color:#24ff5a" />
                    </linearGradient>
                    <linearGradient id="eppp2" y1="1" x2="0">
                        <stop offset="0" style="stop-color:#24ff5d" />
                        <stop offset="1" style="stop-color:#ff0" />
                    </linearGradient>
                </defs>
                <image id="cloud" x="461" y="459" href="https://emwiki.com/imgs/TWOKPhY.png" height="60" width="60"
                    style="filter:opacity(.6)" />
                <text x="489" y="503" text-anchor="middle" stroke="#000" stroke-width="2.3" paint-order="stroke"
                    stroke-linejoin="round" fill="url(#eppp1)"
                    style="animation:floatAnim 12s ease-in-out infinite;font:200 46px Slapstick">EM</text>
                <image id="epic-image" x="464" y="463" href="https://emwiki.com/imgs/epicfaces/kitta.png" height="60"
                    width="60"
                    style="scale:.48;transform:translate(846px,103px);rotate:20deg;transform-origin:center;animation:floatAnim2 15s ease-in-out 1s infinite alternate" />
                <image id="cloud" x="495" y="477" href="https://emwiki.com/imgs/8UUB0Gt.png" height="60" width="60"
                    style="filter:opacity(.86)" />
                <text x="516" y="514" text-anchor="middle" stroke="#000" stroke-width="2.3" paint-order="stroke"
                    stroke-linejoin="round" fill="url(#eppp2)"
                    style="animation:floatAnim 12s ease-in-out infinite;animation-delay:5.5s;font:200 16px Slapstick">wiki</text>
                <image id="cloud" x="445" y="487" href="https://emwiki.com/imgs/oYKd3nJ.png" height="28" width="42"
                    style="filter:opacity(.8)" />
            </svg>
        </a>

        <div class="nav-links">
            <a href="/catalog" class="nav-link">Catalog</a>
            <a href="/trading" class="nav-link active">Trading Hub</a>
            <a href="/forum" class="nav-link">Forum</a>
            <a href="/gallery" class="nav-link">Gallery</a>
            <a href="/scammers" class="nav-link">Scammers</a>
        </div>
    </header>

    <div class="trading-container">


        <div class="trade-panels">
            <div class="trade-panel">
                <div class="panel-header">
                    <div style="display: flex; align-items: center; gap: 0.75rem;">
                        <div class="panel-title">you give</div>
                        <div class="trade-summary" id="youGiveSummary" style="display: none;">
                            <span class="trade-summary-count">0</span> items
                        </div>
                    </div>
                    <button class="r-button" onclick="openCustomModal('youGive')"
                        title="Add Robux or other game items">R</button>
                </div>
                <div class="panel-items empty" id="youGiveItems"></div>
            </div>

            <div class="trade-panel">
                <div class="panel-header">
                    <div style="display: flex; align-items: center; gap: 0.75rem;">
                        <div class="panel-title">they give</div>
                        <div class="trade-summary" id="theyGiveSummary" style="display: none;">
                            <span class="trade-summary-count">0</span> items
                        </div>
                    </div>
                    <button class="r-button" onclick="openCustomModal('theyGive')"
                        title="Add Robux or other game items">R</button>
                </div>
                <div class="panel-items empty" id="theyGiveItems"></div>
            </div>
        </div>

        <div class="all-items-section">
            <div class="section-header">
                <div class="section-title">all items</div>
                <div class="search-box">
                    <input type="text" class="search-input" id="searchInput" placeholder="Search items...">
                </div>
            </div>
            <div class="category-filter" id="categoryFilter"></div>
            <div class="items-grid2" id="allItemsGrid"></div>
            <div class="items-count" id="itemsCount"></div>
            <div class="load-more-container">
                <button class="load-more-btn" id="loadMoreBtn" onclick="loadMoreItems()">Load More</button>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <div class="footer-content">
            <div class="footer-section">
                <h4>Browse</h4>
                <a href="/catalog">Catalog</a>
                <a href="/scammers">Scammers List</a>
                <a href="/admin">Admin Portal</a>
            </div>
            <div class="footer-section">
                <h4>Community</h4>
                <a href="/forum">Forum</a>
                <a href="/trading">Trading</a>
                <a href="/gallery">Gallery</a>
                <a href="https://discord.com/invite/tg">Typical Games Discord</a>
            </div>
            <div class="footer-section">
                <h4>Contact</h4>
                <p>Found a bug? Reach out to <b>@xnite</b> on Discord!</p>
            </div>
        </div>
        <div class="footer-bottom">
            <p>¬© 2025 emwiki.com ‚Ä¢ made with ‚ù§ by xnite</p>
        </div>
    </footer>

    <!-- Custom Item Modal -->
    <div class="trading-modal-overlay" id="customModal">
        <div class="trading-modal-content">
            <div class="trading-modal-header">
                <div class="trading-modal-title">Add Custom Item</div>
                <div class="trading-modal-subtitle">Robux or items from other games</div>
            </div>
            <div class="trading-modal-body">
                <div class="trading-form-group">
                    <div class="trading-form-label">Type</div>
                    <div class="option-group">
                        <button class="option-btn active" data-type="robux" onclick="selectCustomType('robux')">
                            üí∞ Robux
                        </button>
                        <button class="option-btn" data-type="other" onclick="selectCustomType('other')">
                            üéÆ Other Game
                        </button>
                    </div>
                </div>

                <div class="trading-form-group" id="robuxInput">
                    <div class="trading-form-label">Amount</div>
                    <input type="number" class="trading-form-input" id="robuxAmount" placeholder="Enter amount..."
                        min="0" step="1">
                </div>

                <div class="trading-form-group hidden" id="otherGameInput">
                    <div class="trading-form-label">Game Name</div>
                    <input type="text" class="trading-form-input" id="gameName" placeholder="e.g., Adopt Me">
                </div>

                <div class="trading-form-group hidden" id="otherItemInput">
                    <div class="trading-form-label">Item Name</div>
                    <input type="text" class="trading-form-input" id="itemName" placeholder="e.g., Legendary Dragon">
                </div>
            </div>
            <div class="trading-modal-actions">
                <button class="btn btn-secondary" onclick="closeCustomModal()">Cancel</button>
                <button class="btn btn-primary" onclick="addCustomItem()">Add Item</button>
            </div>
        </div>
    </div>

    <script src="./js/script.js"></script>
    <script>
        const state = {
            allItems: [],
            filteredItems: [],
            youGiveItems: [],
            theyGiveItems: [],
            currentPanel: null,
            customType: 'robux',
            categories: ['all', 'gears', 'deaths', 'pets', 'effects', 'titles'],
            activeCategory: 'all',
            sortableInstances: {},
            itemsPerPage: 50,
            currentPage: 0
        };

        async function init() {
            await loadItems();
            renderCategories();
            renderAllItems();
            setupEventListeners();
            initializeSortable();
        }

        async function loadItems() {
            const grid = document.getElementById('allItemsGrid');

            // Show loading skeleton
            grid.innerHTML = Array(12).fill(0).map(() =>
                '<div class="skeleton-card"></div>'
            ).join('');

            try {
                const categories = ['gears', 'deaths', 'pets', 'effects', 'titles'];
                state.allItems = [];

                // Load all categories in parallel
                const categoryPromises = categories.map(async (cat) => {
                    let offset = 0;
                    const limit = 500;
                    let hasMore = true;
                    
                    while (hasMore) {
                        const url = new URL('https://emwiki.com/api/items');
                        url.searchParams.set('category', cat);
                        url.searchParams.set('limit', limit.toString());
                        url.searchParams.set('offset', offset.toString());
                        
                        const res = await fetch(url.toString());
                        if (!res.ok) throw new Error(`Failed to fetch ${cat} items`);
                        
                        const data = await res.json();
                        const items = data.items || [];
                        
                        items.forEach(item => {
                            state.allItems.push({
                                ...item,
                                category: cat
                            });
                        });
                        
                        hasMore = items.length === limit;
                        offset += limit;
                    }
                });
                
                await Promise.all(categoryPromises);

                console.log('‚úÖ Loaded', state.allItems.length, 'items');
            } catch (error) {
                console.error('‚ùå Failed to load items:', error);
                grid.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">‚ö†Ô∏è</div>
                        <div class="empty-state-text">Failed to load items</div>
                        <div class="empty-state-subtext">Please refresh the page to try again</div>
                    </div>
                `;
            }
        }

        function renderCategories() {
            const container = document.getElementById('categoryFilter');
            container.innerHTML = state.categories.map(cat =>
                `<div class="category-pill ${cat === state.activeCategory ? 'active' : ''}"
                      onclick="filterByCategory('${cat}')">${cat}</div>`
            ).join('');
        }

        function filterByCategory(category) {
            state.activeCategory = category;
            renderCategories();
            renderAllItems();
        }

        function renderAllItems(append = false) {
            const grid = document.getElementById('allItemsGrid');
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();

            // Filter items
            let items = state.allItems;

            if (state.activeCategory !== 'all') {
                items = items.filter(item => item.category === state.activeCategory);
            }

            if (searchTerm) {
                items = items.filter(item =>
                    item.name.toLowerCase().includes(searchTerm)
                );
            }

            state.filteredItems = items;

            // Reset pagination if not appending
            if (!append) {
                state.currentPage = 0;
                grid.innerHTML = '';
            }

            // Calculate items to show
            const startIndex = state.currentPage * state.itemsPerPage;
            const endIndex = startIndex + state.itemsPerPage;
            const itemsToShow = items.slice(startIndex, endIndex);

            // Render items
            const itemsHTML = itemsToShow.map(item => `
                <div class="item" data-item='${JSON.stringify(item).replace(/'/g, "&apos;")}'>
                    <img src="${item.img || './imgs/placeholder.png'}" alt="${item.name}">
                    <small class="item-name">${item.name}</small>
                </div>
            `).join('');

            if (append) {
                grid.insertAdjacentHTML('beforeend', itemsHTML);
            } else {
                grid.innerHTML = itemsHTML;
            }

            // Update count and button
            updatePagination();

            if (items.length === 0) {
                grid.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üîç</div>
                        <div class="empty-state-text">No items found</div>
                        <div class="empty-state-subtext">Try adjusting your search or category filter</div>
                    </div>
                `;
            }
        }

        function updatePagination() {
            const totalItems = state.filteredItems.length;
            const shownItems = Math.min((state.currentPage + 1) * state.itemsPerPage, totalItems);
            const hasMore = shownItems < totalItems;

            // Update count
            const countEl = document.getElementById('itemsCount');
            countEl.textContent = `Showing ${shownItems} of ${totalItems} items`;

            // Update button
            const btnEl = document.getElementById('loadMoreBtn');
            if (hasMore) {
                btnEl.disabled = false;
                btnEl.textContent = `Load More (${Math.min(state.itemsPerPage, totalItems - shownItems)} more)`;
                btnEl.style.display = 'block';
            } else {
                btnEl.disabled = true;
                btnEl.textContent = 'All items loaded';
                if (totalItems === 0) {
                    btnEl.style.display = 'none';
                }
            }
        }

        function loadMoreItems() {
            state.currentPage++;
            renderAllItems(true);
        }

        function setupEventListeners() {
            document.getElementById('searchInput').addEventListener('input', renderAllItems);
        }

        function initializeSortable() {
            const allItemsGrid = document.getElementById('allItemsGrid');
            const youGivePanel = document.getElementById('youGiveItems');
            const theyGivePanel = document.getElementById('theyGiveItems');

            // Sortable for all items (source)
            state.sortableInstances.allItems = new Sortable(allItemsGrid, {
                group: {
                    name: 'shared',
                    pull: 'clone',
                    put: false
                },
                animation: 150,
                sort: false,
                ghostClass: 'sortable-ghost',
                dragClass: 'sortable-drag',
                onEnd: function (evt) {
                    // Remove the cloned item from source
                    if (evt.to !== evt.from) {
                        evt.item.remove();
                    }
                }
            });

            // Sortable for youGive panel
            state.sortableInstances.youGive = new Sortable(youGivePanel, {
                group: 'shared',
                animation: 150,
                ghostClass: 'sortable-ghost',
                dragClass: 'sortable-drag',
                onAdd: function (evt) {
                    const item = evt.item;
                    const itemData = JSON.parse(item.dataset.item);
                    addItemToPanel(itemData, 'youGive', evt.newIndex);
                },
                onEnd: function () {
                    updatePanelState('youGive');
                }
            });

            // Sortable for theyGive panel
            state.sortableInstances.theyGive = new Sortable(theyGivePanel, {
                group: 'shared',
                animation: 150,
                ghostClass: 'sortable-ghost',
                dragClass: 'sortable-drag',
                onAdd: function (evt) {
                    const item = evt.item;
                    const itemData = JSON.parse(item.dataset.item);
                    addItemToPanel(itemData, 'theyGive', evt.newIndex);
                },
                onEnd: function () {
                    updatePanelState('theyGive');
                }
            });
        }

        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;

            const icons = {
                success: '‚úÖ',
                error: '‚ùå',
                info: '‚ÑπÔ∏è'
            };

            toast.innerHTML = `
                <div class="toast-icon">${icons[type]}</div>
                <div class="toast-message">${message}</div>
            `;

            document.body.appendChild(toast);

            setTimeout(() => {
                toast.style.animation = 'slideInRight 0.3s ease-out reverse';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        function addItemToPanel(item, panelType, index) {
            const panel = panelType === 'youGive' ? state.youGiveItems : state.theyGiveItems;

            // Check if item already exists
            if (panel.some(i => i.name === item.name && i.type === 'game-item')) {
                showToast('Item already added to this panel', 'info');
                renderPanel(panelType);
                return;
            }

            // Add at specific index or end
            if (index !== undefined) {
                panel.splice(index, 0, { ...item, type: 'game-item' });
            } else {
                panel.push({ ...item, type: 'game-item' });
            }

            showToast(`Added ${item.name}`, 'success');
            renderPanel(panelType);
        }

        function updatePanelState(panelType) {
            const container = document.getElementById(`${panelType}Items`);
            const items = Array.from(container.querySelectorAll('.panel-item'));

            // Clear and rebuild state based on current DOM order
            if (panelType === 'youGive') {
                state.youGiveItems = [];
            } else {
                state.theyGiveItems = [];
            }

            items.forEach(itemEl => {
                const itemData = itemEl.dataset.itemData;
                if (itemData) {
                    const panel = panelType === 'youGive' ? state.youGiveItems : state.theyGiveItems;
                    panel.push(JSON.parse(itemData));
                }
            });
        }

        function renderPanel(panelType) {
            const container = document.getElementById(`${panelType}Items`);
            const items = panelType === 'youGive' ? state.youGiveItems : state.theyGiveItems;
            const summaryEl = document.getElementById(`${panelType}Summary`);

            // Update counter badge
            if (items.length > 0) {
                summaryEl.style.display = 'flex';
                summaryEl.querySelector('.trade-summary-count').textContent = items.length;
            } else {
                summaryEl.style.display = 'none';
            }

            if (items.length === 0) {
                container.classList.add('empty');
                container.innerHTML = '';
                return;
            }

            container.classList.remove('empty');
            container.innerHTML = items.map((item, index) => {
                if (item.type === 'robux') {
                    return `
                        <div class="panel-item custom-item" data-item-data='${JSON.stringify(item).replace(/'/g, "&apos;")}'>
                            <button class="remove-wishlist" onclick="removeItem('${panelType}', ${index})">√ó</button>
                            <div class="custom-item-icon">üí∞</div>
                            <div class="custom-item-text">${item.amount} R$</div>
                        </div>
                    `;
                } else if (item.type === 'other-game') {
                    return `
                        <div class="panel-item custom-item" data-item-data='${JSON.stringify(item).replace(/'/g, "&apos;")}'>
                            <button class="remove-wishlist" onclick="removeItem('${panelType}', ${index})">√ó</button>
                            <div class="custom-item-icon">üéÆ</div>
                            <div class="custom-item-text">${item.gameName}: ${item.itemName}</div>
                        </div>
                    `;
                } else {
                    return `
                        <div class="panel-item" data-item='${JSON.stringify(item).replace(/'/g, "&apos;")}' data-item-data='${JSON.stringify(item).replace(/'/g, "&apos;")}'>
                            <button class="remove-wishlist" onclick="removeItem('${panelType}', ${index})">√ó</button>
                            <img  src="${item.img || './imgs/placeholder.png'}" alt="${item.name}">
                            <small class="item-name">${item.name}</small>
                        </div>
                    `;
                }
            }).join('');
        }

        function removeItem(panelType, index) {
            const panel = panelType === 'youGive' ? state.youGiveItems : state.theyGiveItems;
            panel.splice(index, 1);
            renderPanel(panelType);
        }

        function openCustomModal(panel) {
            state.currentPanel = panel;
            document.getElementById('customModal').classList.add('active');

            document.getElementById('robuxAmount').value = '';
            document.getElementById('gameName').value = '';
            document.getElementById('itemName').value = '';
            selectCustomType('robux');
        }

        function closeCustomModal() {
            document.getElementById('customModal').classList.remove('active');
            state.currentPanel = null;
        }

        function selectCustomType(type) {
            state.customType = type;

            document.querySelectorAll('.option-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.type === type);
            });

            if (type === 'robux') {
                document.getElementById('robuxInput').classList.remove('hidden');
                document.getElementById('otherGameInput').classList.add('hidden');
                document.getElementById('otherItemInput').classList.add('hidden');
            } else {
                document.getElementById('robuxInput').classList.add('hidden');
                document.getElementById('otherGameInput').classList.remove('hidden');
                document.getElementById('otherItemInput').classList.remove('hidden');
            }
        }

        function addCustomItem() {
            if (!state.currentPanel) return;

            const panel = state.currentPanel === 'youGive' ? state.youGiveItems : state.theyGiveItems;

            if (state.customType === 'robux') {
                const amount = parseInt(document.getElementById('robuxAmount').value);
                if (!amount || amount <= 0) {
                    alert('Please enter a valid amount');
                    return;
                }
                panel.push({ type: 'robux', amount });
            } else {
                const gameName = document.getElementById('gameName').value.trim();
                const itemName = document.getElementById('itemName').value.trim();

                if (!gameName || !itemName) {
                    alert('Please fill in all fields');
                    return;
                }

                panel.push({ type: 'other-game', gameName, itemName });
            }

            renderPanel(state.currentPanel);
            closeCustomModal();
        }

        document.getElementById('customModal').addEventListener('click', (e) => {
            if (e.target.id === 'customModal') {
                closeCustomModal();
            }
        });

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeCustomModal();
            }
        });

        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>

</html>