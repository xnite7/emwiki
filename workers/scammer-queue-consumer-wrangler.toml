name = "scammer-queue-consumer"
main = "scammer-queue-consumer.js"
compatibility_date = "2024-01-01"

# D1 Database binding (same as your Pages project)
# IMPORTANT: The binding name must match what your Pages Functions use
# Check your Pages project settings to see if it's "DB" or "DBA"
[[d1_databases]]
binding = "DB"  # Change to "DBA" if that's what your Pages project uses
database_name = "DBA"
database_id = "YOUR_D1_DATABASE_ID"  # Replace with your actual D1 database ID

# R2 bucket binding (REQUIRED for downloading thread images/videos)
[[r2_buckets]]
binding = "MY_BUCKET"
bucket_name = "YOUR_R2_BUCKET_NAME"  # Replace with your actual R2 bucket name

# Queue consumer binding
[[queues.consumers]]
queue = "scammer-messages"
max_batch_size = 10        # Number of messages per batch
max_batch_timeout = 10     # Max seconds to wait for batch to fill (10 seconds)
max_retries = 3            # Max retries before giving up
retry_delay = 2            # Seconds to wait before retry (2s to respect Discord rate limits)
# max_concurrency = "auto"  # Auto-scaling (recommended, set in dashboard)
dead_letter_queue = "scammer-messages-dlq"  # Queue for messages that fail after max retries

# Environment variables (set via wrangler secret put or dashboard)
# DISCORD_BOT_TOKEN (REQUIRED)
# CLOUDFLARE_ACCOUNT_ID (optional, for Stream)
# CLOUDFLARE_STREAM_TOKEN (optional, for Stream)

