name = "scammer-queue-consumer"
main = "scammer-queue-consumer.js"
compatibility_date = "2024-01-01"

# D1 Database binding (same as your Pages project)
# IMPORTANT: The binding name must match what your Pages Functions use
# Check your Pages project settings to see if it's "DB" or "DBA"
[[d1_databases]]
binding = "DB"  # Change to "DBA" if that's what your Pages project uses
database_name = "DBA"
database_id = "YOUR_D1_DATABASE_ID"  # Replace with your actual D1 database ID

# Queue consumer binding
[[queues.consumers]]
queue = "scammer-messages"
max_batch_size = 10        # Number of messages per batch
max_batch_timeout = 10     # Max seconds to wait for batch to fill (10 seconds)
max_retries = 3            # Max retries before giving up
retry_delay = 2            # Seconds to wait before retry (2s to respect Discord rate limits)
# max_concurrency = "auto"  # Auto-scaling (recommended, set in dashboard)
dead_letter_queue = "scammer-messages-dlq"  # Queue for messages that fail after max retries

# ============================================================================
# REQUIRED SECRETS (set via: wrangler secret put SECRET_NAME)
# ============================================================================
# DISCORD_BOT_TOKEN - Your Discord bot token

# ============================================================================
# CLOUDFLARE IMAGES (for image evidence)
# ============================================================================
# CLOUDFLARE_ACCOUNT_ID - Your Cloudflare account ID (found in dashboard URL)
# CLOUDFLARE_IMAGES_TOKEN - API token with Images:Edit permission
#   OR use CLOUDFLARE_API_TOKEN with both Images and Stream permissions

# ============================================================================
# CLOUDFLARE STREAM (for video evidence)
# ============================================================================
# CLOUDFLARE_STREAM_TOKEN - API token with Stream:Edit permission
#   OR use CLOUDFLARE_API_TOKEN with both Images and Stream permissions

